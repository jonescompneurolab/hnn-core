
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>hnn_core.gui.gui &#8212; hnn-core 0.5.1.dev0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=215e94d7"></script>
    <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=fd10adb8"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/hnn_core/gui/gui';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://jonescompneurolab.github.io/hnn-core/dev/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.5.1.dev0" />

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-199741045-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-199741045-1');
</script>


  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/hnn-medium.png" class="logo__image only-light" alt="hnn-core 0.5.1.dev0 documentation - Home"/>
    <img src="../../../_static/hnn-medium.png" class="logo__image only-dark pst-js-only" alt="hnn-core 0.5.1.dev0 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../install.html">
    Install (Textbook)
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../auto_examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../whats_new.html">
    What’s new?
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../contributing.html">
    Contributing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/jonescompneurolab/hnn-core">
    GitHub (Code)
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://hnn.brown.edu/">
    HNN Frontpage
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://jonescompneurolab.github.io/textbook/content/preface.html">
    HNN Textbook
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://pypi.org/project/hnn-core/">
    PyPI package
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://anaconda.org/jonescompneurolab/repo">
    Conda packages
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../install.html">
    Install (Textbook)
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../auto_examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../whats_new.html">
    What’s new?
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../contributing.html">
    Contributing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/jonescompneurolab/hnn-core">
    GitHub (Code)
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://hnn.brown.edu/">
    HNN Frontpage
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://jonescompneurolab.github.io/textbook/content/preface.html">
    HNN Textbook
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://pypi.org/project/hnn-core/">
    PyPI package
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://anaconda.org/jonescompneurolab/repo">
    Conda packages
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">hnn_core.gui.gui</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for hnn_core.gui.gui</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;IPywidgets GUI.&quot;&quot;&quot;</span>

<span class="c1"># Authors: Mainak Jas &lt;mjas@mgh.harvard.edu&gt;</span>
<span class="c1">#          Huzi Cheng &lt;hzcheng15@icloud.com&gt;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">codecs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mimetypes</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib.parse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib.request</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">IFrame</span><span class="p">,</span> <span class="n">display</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">HTML</span><span class="p">,</span>
    <span class="n">Accordion</span><span class="p">,</span>
    <span class="n">AppLayout</span><span class="p">,</span>
    <span class="n">FloatText</span><span class="p">,</span>
    <span class="n">BoundedFloatText</span><span class="p">,</span>
    <span class="n">BoundedIntText</span><span class="p">,</span>
    <span class="n">Button</span><span class="p">,</span>
    <span class="n">Dropdown</span><span class="p">,</span>
    <span class="n">FileUpload</span><span class="p">,</span>
    <span class="n">VBox</span><span class="p">,</span>
    <span class="n">HBox</span><span class="p">,</span>
    <span class="n">IntText</span><span class="p">,</span>
    <span class="n">Layout</span><span class="p">,</span>
    <span class="n">Output</span><span class="p">,</span>
    <span class="n">RadioButtons</span><span class="p">,</span>
    <span class="n">Tab</span><span class="p">,</span>
    <span class="n">Text</span><span class="p">,</span>
    <span class="n">Checkbox</span><span class="p">,</span>
    <span class="n">Box</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets.embed</span><span class="w"> </span><span class="kn">import</span> <span class="n">embed_minimal_html</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hnn_core</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hnn_core</span><span class="w"> </span><span class="kn">import</span> <span class="n">JoblibBackend</span><span class="p">,</span> <span class="n">MPIBackend</span><span class="p">,</span> <span class="n">simulate_dipole</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hnn_core.gui._logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hnn_core.gui._viz_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">_VizManager</span><span class="p">,</span> <span class="n">_idx2figname</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hnn_core.network</span><span class="w"> </span><span class="kn">import</span> <span class="n">pick_connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hnn_core.dipole</span><span class="w"> </span><span class="kn">import</span> <span class="n">_read_dipole_txt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hnn_core.params_default</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_L2Pyr_params_default</span><span class="p">,</span> <span class="n">get_L5Pyr_params_default</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hnn_core.hnn_io</span><span class="w"> </span><span class="kn">import</span> <span class="n">dict_to_network</span><span class="p">,</span> <span class="n">write_network_configuration</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hnn_core.cells_default</span><span class="w"> </span><span class="kn">import</span> <span class="n">_exp_g_at_dist</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hnn_core.parallel_backends</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">_determine_cores_hwthreading</span><span class="p">,</span>
    <span class="n">_has_mpi4py</span><span class="p">,</span>
    <span class="n">_has_psutil</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">hnn_core_root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">hnn_core</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<span class="n">default_network_configuration</span> <span class="o">=</span> <span class="n">hnn_core_root</span> <span class="o">/</span> <span class="s2">&quot;param&quot;</span> <span class="o">/</span> <span class="s2">&quot;jones2009_base.json&quot;</span>

<span class="n">cell_parameters_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Geometry L2&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;Soma length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma capacitive density&quot;</span><span class="p">,</span> <span class="s2">&quot;F/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_cm&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma resistivity&quot;</span><span class="p">,</span> <span class="s2">&quot;ohm-cm&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_Ra&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite capacitive density&quot;</span><span class="p">,</span> <span class="s2">&quot;F/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_cm&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite resistivity&quot;</span><span class="p">,</span> <span class="s2">&quot;ohm-cm&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_Ra&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite Trunk length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apicaltrunk_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite Trunk diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apicaltrunk_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite 1 length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apical1_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite 1 diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apical1_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite Tuft length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apicaltuft_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite Tuft diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apicaltuft_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Oblique Apical Dendrite length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apicaloblique_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Oblique Apical Dendrite diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apicaloblique_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Basal Dendrite 1 length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;basal1_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Basal Dendrite 1 diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;basal1_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Basal Dendrite 2 length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;basal2_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Basal Dendrite 2 diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;basal2_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Basal Dendrite 3 length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;basal3_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Basal Dendrite 3 diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;basal3_diam&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;Geometry L5&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;Soma length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma capacitive density&quot;</span><span class="p">,</span> <span class="s2">&quot;F/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_cm&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma resistivity&quot;</span><span class="p">,</span> <span class="s2">&quot;ohm-cm&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_Ra&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite capacitive density&quot;</span><span class="p">,</span> <span class="s2">&quot;F/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_cm&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite resistivity&quot;</span><span class="p">,</span> <span class="s2">&quot;ohm-cm&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_Ra&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite Trunk length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apicaltrunk_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite Trunk diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apicaltrunk_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite 1 length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apical1_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite 1 diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apical1_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite 2 length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apical2_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite 2 diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apical2_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite Tuft length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apicaltuft_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Apical Dendrite Tuft diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apicaltuft_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Oblique Apical Dendrite length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apicaloblique_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Oblique Apical Dendrite diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;apicaloblique_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Basal Dendrite 1 length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;basal1_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Basal Dendrite 1 diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;basal1_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Basal Dendrite 2 length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;basal2_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Basal Dendrite 2 diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;basal2_diam&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Basal Dendrite 3 length&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;basal3_L&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Basal Dendrite 3 diameter&quot;</span><span class="p">,</span> <span class="s2">&quot;micron&quot;</span><span class="p">,</span> <span class="s2">&quot;basal3_diam&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;Synapses&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;AMPA reversal&quot;</span><span class="p">,</span> <span class="s2">&quot;mV&quot;</span><span class="p">,</span> <span class="s2">&quot;ampa_e&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;AMPA rise time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;ampa_tau1&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;AMPA decay time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;ampa_tau2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;NMDA reversal&quot;</span><span class="p">,</span> <span class="s2">&quot;mV&quot;</span><span class="p">,</span> <span class="s2">&quot;nmda_e&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;NMDA rise time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;nmda_tau1&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;NMDA decay time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;nmda_tau2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;GABAA reversal&quot;</span><span class="p">,</span> <span class="s2">&quot;mV&quot;</span><span class="p">,</span> <span class="s2">&quot;gabaa_e&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;GABAA rise time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;gabaa_tau1&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;GABAA decay time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;gabaa_tau2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;GABAB reversal&quot;</span><span class="p">,</span> <span class="s2">&quot;mV&quot;</span><span class="p">,</span> <span class="s2">&quot;gabab_e&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;GABAB rise time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;gabab_tau1&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;GABAB decay time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;gabab_tau2&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;Biophysics L2&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;Soma Kv channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_gkbar_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma Na channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_gnabar_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma leak reversal&quot;</span><span class="p">,</span> <span class="s2">&quot;mV&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_el_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma leak channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_gl_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma Km channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;pS/micron2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_gbar_km&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite Kv channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_gkbar_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite Na channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_gnabar_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite leak reversal&quot;</span><span class="p">,</span> <span class="s2">&quot;mV&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_el_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite leak channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_gl_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite Km channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;pS/micron2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_gbar_km&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;Biophysics L5&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;Soma Kv channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_gkbar_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma Na channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_gnabar_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma leak reversal&quot;</span><span class="p">,</span> <span class="s2">&quot;mV&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_el_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma leak channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_gl_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma Ca channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;pS/micron2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_gbar_ca&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma Ca decay time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_taur_cad&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma Kca channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;pS/micron2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_gbar_kca&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma Km channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;pS/micron2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_gbar_km&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma CaT channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_gbar_cat&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Soma HCN channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;soma_gbar_ar&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite Kv channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_gkbar_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite Na channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_gnabar_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite leak reversal&quot;</span><span class="p">,</span> <span class="s2">&quot;mV&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_el_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite leak channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_gl_hh2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite Ca channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;pS/micron2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_gbar_ca&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite Ca decay time&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_taur_cad&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite KCa channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;pS/micron2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_gbar_kca&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite Km channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;pS/micron2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_gbar_km&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite CaT channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_gbar_cat&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dendrite HCN channel density&quot;</span><span class="p">,</span> <span class="s2">&quot;S/cm2&quot;</span><span class="p">,</span> <span class="s2">&quot;dend_gbar_ar&quot;</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">}</span>

<span class="n">global_gain_type_display_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;e_e&quot;</span><span class="p">:</span> <span class="s2">&quot;Exc-to-Exc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;e_i&quot;</span><span class="p">:</span> <span class="s2">&quot;Exc-to-Inh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;i_e&quot;</span><span class="p">:</span> <span class="s2">&quot;Inh-to-Exc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;i_i&quot;</span><span class="p">:</span> <span class="s2">&quot;Inh-to-Inh&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">global_gain_type_lookup_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="s2">&quot;L2_pyramidal&quot;</span><span class="p">,</span> <span class="s2">&quot;L2_pyramidal&quot;</span><span class="p">):</span> <span class="s2">&quot;e_e&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;L2_pyramidal&quot;</span><span class="p">,</span> <span class="s2">&quot;L5_pyramidal&quot;</span><span class="p">):</span> <span class="s2">&quot;e_e&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;L5_pyramidal&quot;</span><span class="p">,</span> <span class="s2">&quot;L5_pyramidal&quot;</span><span class="p">):</span> <span class="s2">&quot;e_e&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;L2_pyramidal&quot;</span><span class="p">,</span> <span class="s2">&quot;L2_basket&quot;</span><span class="p">):</span> <span class="s2">&quot;e_i&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;L2_pyramidal&quot;</span><span class="p">,</span> <span class="s2">&quot;L5_basket&quot;</span><span class="p">):</span> <span class="s2">&quot;e_i&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;L5_pyramidal&quot;</span><span class="p">,</span> <span class="s2">&quot;L5_basket&quot;</span><span class="p">):</span> <span class="s2">&quot;e_i&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;L2_basket&quot;</span><span class="p">,</span> <span class="s2">&quot;L2_pyramidal&quot;</span><span class="p">):</span> <span class="s2">&quot;i_e&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;L2_basket&quot;</span><span class="p">,</span> <span class="s2">&quot;L5_pyramidal&quot;</span><span class="p">):</span> <span class="s2">&quot;i_e&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;L5_basket&quot;</span><span class="p">,</span> <span class="s2">&quot;L5_pyramidal&quot;</span><span class="p">):</span> <span class="s2">&quot;i_e&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;L2_basket&quot;</span><span class="p">,</span> <span class="s2">&quot;L2_basket&quot;</span><span class="p">):</span> <span class="s2">&quot;i_i&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;L5_basket&quot;</span><span class="p">,</span> <span class="s2">&quot;L5_basket&quot;</span><span class="p">):</span> <span class="s2">&quot;i_i&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_OutputWidgetHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Handler</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_widget</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_OutputWidgetHandler</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span> <span class="o">=</span> <span class="n">output_widget</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">formatted_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="c1"># Further format the message for GUI presentation</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">formatted_record</span> <span class="o">=</span> <span class="n">formatted_record</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  - &quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">formatted_record</span> <span class="o">=</span> <span class="s2">&quot;[TIME] &quot;</span> <span class="o">+</span> <span class="n">formatted_record</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">new_output</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;stdout&quot;</span><span class="p">,</span>
            <span class="s2">&quot;output_type&quot;</span><span class="p">:</span> <span class="s2">&quot;stream&quot;</span><span class="p">,</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">formatted_record</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_output</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">outputs</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_GUI_PrintToLogger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to redirect print messages to the logger in the GUI&quot;&quot;&quot;</span>

    <span class="c1"># when print is used, call the write method instead</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="c1"># avoid logging empty/new lines</span>
        <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="c1"># send the message to the logger</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="c1"># The flush method is required for compatibility with print</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="c1"># assign class to stdout to redirect print statements to the logger</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">_GUI_PrintToLogger</span><span class="p">()</span>


<div class="viewcode-block" id="HNNGUI">
<a class="viewcode-back" href="../../../generated/hnn_core.gui.HNNGUI.html#hnn_core.gui.HNNGUI">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HNNGUI</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;HNN GUI class</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theme_color : str</span>
<span class="sd">        The theme color of the whole dashboard.</span>
<span class="sd">    total_height : int</span>
<span class="sd">        The height of the GUI (in pixel, same for all following parameters).</span>
<span class="sd">    total_width : int</span>
<span class="sd">        The width of the GUI.</span>
<span class="sd">    header_height : int</span>
<span class="sd">        The height of the header.</span>
<span class="sd">    button_height : int</span>
<span class="sd">        The height of buttons.</span>
<span class="sd">    operation_box_height : int</span>
<span class="sd">        The operation_box_height of operations box.</span>
<span class="sd">    drive_widget_width : int</span>
<span class="sd">        The width of GUI drive box.</span>
<span class="sd">    left_sidebar_width : int</span>
<span class="sd">        The width of left sidebad.</span>
<span class="sd">    log_window_height : int</span>
<span class="sd">        The height of logging window.</span>
<span class="sd">    status_height : int</span>
<span class="sd">        The height of status bar.</span>
<span class="sd">    dpi : int</span>
<span class="sd">        The screen dpi.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    layout : dict</span>
<span class="sd">        The styling configuration of GUI.</span>
<span class="sd">    params : dict</span>
<span class="sd">        The parameters to use for constructing the network.</span>
<span class="sd">    simulation_data : dict</span>
<span class="sd">        Simulation related objects, such as net and dpls.</span>
<span class="sd">    widget_tstop : Widget</span>
<span class="sd">        Simulation stop time widget.</span>
<span class="sd">    widget_dt : Widget</span>
<span class="sd">        Simulation step size widget.</span>
<span class="sd">    widget_ntrials : Widget</span>
<span class="sd">        Widget that controls the number of trials in a single simulation.</span>
<span class="sd">    widget_backend_selection : Widget</span>
<span class="sd">        Widget that selects the backend used in simulations.</span>
<span class="sd">    widget_viz_layout_selection : Widget</span>
<span class="sd">        Widget that selects the layout of visualization window.</span>
<span class="sd">    widget_mpi_cmd : Widget</span>
<span class="sd">        Widget that specify the mpi command to use when the backend is</span>
<span class="sd">        MPIBackend.</span>
<span class="sd">    widget_n_jobs : Widget</span>
<span class="sd">        Widget that specify the cores in multi-trial simulations.</span>
<span class="sd">    widget_drive_type_selection : Widget</span>
<span class="sd">        Widget that is used to select the drive to be added to the network.</span>
<span class="sd">    widget_location_selection : Widget.</span>
<span class="sd">        Widget that specifies the location of network drives. Could be proximal</span>
<span class="sd">        or distal.</span>
<span class="sd">    add_drive_button : Widget</span>
<span class="sd">        Clickable widget that is used to add a drive to the network.</span>
<span class="sd">    run_button : Widget</span>
<span class="sd">        Clickable widget that triggers simulation.</span>
<span class="sd">    load_button : Widget</span>
<span class="sd">        Clickable widget that receives uploaded parameter files.</span>
<span class="sd">    delete_drive_button : Widget</span>
<span class="sd">        Clickable widget that clear all existing network drives.</span>
<span class="sd">    plot_outputs_dict : list</span>
<span class="sd">        A list of visualization panel outputs.</span>
<span class="sd">    plot_dropdown_types_dict : list</span>
<span class="sd">        A list of dropdown menus that control the plot types in</span>
<span class="sd">        plot_outputs_dict.</span>
<span class="sd">    drive_widgets : list</span>
<span class="sd">        A list of network drive widgets added by add_drive_button.</span>
<span class="sd">    drive_boxes : list</span>
<span class="sd">        A list of network drive layouts.</span>
<span class="sd">    connectivity_textfields : list</span>
<span class="sd">        A list of boxes that control the weight and probability of connections</span>
<span class="sd">        in the network.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">theme_color</span><span class="o">=</span><span class="s2">&quot;#802989&quot;</span><span class="p">,</span>
        <span class="n">total_height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">total_width</span><span class="o">=</span><span class="mi">1300</span><span class="p">,</span>
        <span class="n">header_height</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">button_height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">operation_box_height</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">drive_widget_width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">left_sidebar_width</span><span class="o">=</span><span class="mi">576</span><span class="p">,</span>
        <span class="n">log_window_height</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
        <span class="n">status_height</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="mi">96</span><span class="p">,</span>
        <span class="n">network_configuration</span><span class="o">=</span><span class="n">default_network_configuration</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># set up styling.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_height</span> <span class="o">=</span> <span class="n">total_height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_width</span> <span class="o">=</span> <span class="n">total_width</span>

        <span class="n">viz_win_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_width</span> <span class="o">-</span> <span class="n">left_sidebar_width</span>
        <span class="n">main_content_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_height</span> <span class="o">-</span> <span class="n">status_height</span>

        <span class="n">config_box_height</span> <span class="o">=</span> <span class="n">main_content_height</span> <span class="o">-</span> <span class="p">(</span>
            <span class="n">log_window_height</span> <span class="o">+</span> <span class="n">operation_box_height</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;dpi&quot;</span><span class="p">:</span> <span class="n">dpi</span><span class="p">,</span>
            <span class="s2">&quot;header_height&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">header_height</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span>
            <span class="s2">&quot;theme_color&quot;</span><span class="p">:</span> <span class="n">theme_color</span><span class="p">,</span>
            <span class="s2">&quot;btn&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">button_height</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">),</span>
            <span class="s2">&quot;run_btn&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">button_height</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;10%&quot;</span><span class="p">),</span>
            <span class="s2">&quot;btn_full_w&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">button_height</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">),</span>
            <span class="s2">&quot;del_fig_btn&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">button_height</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">),</span>
            <span class="s2">&quot;log_out&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span>
                <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid gray&quot;</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">log_window_height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span>
                <span class="n">overflow</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s2">&quot;viz_config&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;99%&quot;</span><span class="p">),</span>
            <span class="s2">&quot;simulations_list&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_sidebar_width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">50</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">),</span>
            <span class="s2">&quot;visualization_window&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">viz_win_width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">main_content_height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span>
                <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid gray&quot;</span><span class="p">,</span>
                <span class="n">overflow</span><span class="o">=</span><span class="s2">&quot;scroll&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s2">&quot;visualization_output&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">viz_win_width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">50</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">main_content_height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">100</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span>
                <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid gray&quot;</span><span class="p">,</span>
                <span class="n">overflow</span><span class="o">=</span><span class="s2">&quot;scroll&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s2">&quot;left_sidebar&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_sidebar_width</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">main_content_height</span><span class="si">}</span><span class="s2">px&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;left_tab&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_sidebar_width</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_box_height</span><span class="si">}</span><span class="s2">px&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;operation_box&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_sidebar_width</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">operation_box_height</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span>
                <span class="n">flex_wrap</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s2">&quot;config_box&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_sidebar_width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">40</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_box_height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">100</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s2">&quot;drive_widget&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">),</span>
            <span class="s2">&quot;drive_textbox&quot;</span><span class="p">:</span> <span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;270px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">),</span>
            <span class="c1"># simulation status related</span>
            <span class="s2">&quot;simulation_status_height&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status_height</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">,</span>
            <span class="s2">&quot;simulation_status_common&quot;</span><span class="p">:</span> <span class="s2">&quot;background:gray;padding-left:10px&quot;</span><span class="p">,</span>
            <span class="s2">&quot;simulation_status_running&quot;</span><span class="p">:</span> <span class="s2">&quot;background:orange;padding-left:10px&quot;</span><span class="p">,</span>
            <span class="s2">&quot;simulation_status_failed&quot;</span><span class="p">:</span> <span class="s2">&quot;background:red;padding-left:10px&quot;</span><span class="p">,</span>
            <span class="s2">&quot;simulation_status_finished&quot;</span><span class="p">:</span> <span class="s2">&quot;background:green;padding-left:10px&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_simulation_status_contents</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;not_running&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;div style=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;simulation_status_common&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            color:white;&#39;&gt;Not running&lt;/div&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;running&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;div style=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;simulation_status_running&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            color:white;&#39;&gt;Running...&lt;/div&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;finished&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;div style=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;simulation_status_finished&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            color:white;&#39;&gt;Simulation finished&lt;/div&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;div style=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;simulation_status_failed&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            color:white;&#39;&gt;Simulation failed&lt;/div&gt;&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># load default parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">network_configuration</span><span class="p">)</span>

        <span class="c1"># Number of available cores</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cores</span><span class="p">,</span> <span class="n">_</span><span class="p">]</span> <span class="o">=</span> <span class="n">_determine_cores_hwthreading</span><span class="p">(</span>
            <span class="n">use_hwthreading_if_found</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">sensible_default_cores</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># In-memory storage of all simulation and visualization related data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">net</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dpls</span><span class="o">=</span><span class="nb">list</span><span class="p">()))</span>

        <span class="c1"># Default visualization params for figures</span>
        <span class="n">analysis_style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;200px&quot;</span><span class="p">}</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;300px&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">widget_default_smoothing</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Dipole Smoothing:&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">analysis_style</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">widget_default_scaling</span> <span class="o">=</span> <span class="n">FloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="mf">3000.0</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Dipole Scaling:&quot;</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">analysis_style</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">widget_min_frequency</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Min Spectral Frequency (Hz):&quot;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">analysis_style</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">widget_max_frequency</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Max Spectral Frequency (Hz):&quot;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">analysis_style</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_default_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;default_smoothing&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_default_smoothing</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;default_scaling&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_default_scaling</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;default_min_frequency&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_min_frequency</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;default_max_frequency&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_max_frequency</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Simulation parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget_tstop</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">170</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;tstop (ms):&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget_dt</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;dt (ms):&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget_ntrials</span> <span class="o">=</span> <span class="n">IntText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Trials:&quot;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget_simulation_name</span> <span class="o">=</span> <span class="n">Text</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
            <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;ID of your simulation&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Name:&quot;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget_backend_selection</span> <span class="o">=</span> <span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Joblib&quot;</span><span class="p">,</span> <span class="s2">&quot;Joblib&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;MPI&quot;</span><span class="p">,</span> <span class="s2">&quot;MPI&quot;</span><span class="p">)],</span>
            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_backend</span><span class="p">(),</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Backend:&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget_mpi_cmd</span> <span class="o">=</span> <span class="n">Text</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;mpiexec&quot;</span><span class="p">,</span>
            <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Fill if applies&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;MPI cmd:&quot;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget_n_jobs</span> <span class="o">=</span> <span class="n">BoundedIntText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cores</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Cores:&quot;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data_button</span> <span class="o">=</span> <span class="n">FileUpload</span><span class="p">(</span>
            <span class="n">accept</span><span class="o">=</span><span class="s2">&quot;.txt,.csv&quot;</span><span class="p">,</span>
            <span class="n">multiple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;button_color&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;theme_color&quot;</span><span class="p">]},</span>
            <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;btn&quot;</span><span class="p">],</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Load data&quot;</span><span class="p">,</span>
            <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Create save simulation widget wrapper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_simuation_button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_html_download_button</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Save Simulation&quot;</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s2">&quot;text/csv&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_config_button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_html_download_button</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Save Network&quot;</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s2">&quot;application/json&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_list_widget</span> <span class="o">=</span> <span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[],</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;15%&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># Drive selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget_drive_type_selection</span> <span class="o">=</span> <span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Evoked&quot;</span><span class="p">,</span> <span class="s2">&quot;Poisson&quot;</span><span class="p">,</span> <span class="s2">&quot;Rhythmic&quot;</span><span class="p">,</span> <span class="s2">&quot;Tonic&quot;</span><span class="p">],</span>
            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Evoked&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Drive type:&quot;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;drive_widget&quot;</span><span class="p">],</span>
            <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;100px&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget_location_selection</span> <span class="o">=</span> <span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Proximal&quot;</span><span class="p">,</span> <span class="s2">&quot;Distal&quot;</span><span class="p">],</span>
            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Proximal&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Drive location:&quot;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;drive_widget&quot;</span><span class="p">],</span>
            <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;100px&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_drive_button</span> <span class="o">=</span> <span class="n">create_expanded_button</span><span class="p">(</span>
            <span class="s2">&quot;Add drive&quot;</span><span class="p">,</span>
            <span class="s2">&quot;primary&quot;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;btn&quot;</span><span class="p">],</span>
            <span class="n">button_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;theme_color&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># Dashboard level buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_button</span> <span class="o">=</span> <span class="n">create_expanded_button</span><span class="p">(</span>
            <span class="s2">&quot;Run&quot;</span><span class="p">,</span>
            <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;run_btn&quot;</span><span class="p">],</span>
            <span class="n">button_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;theme_color&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_connectivity_button</span> <span class="o">=</span> <span class="n">FileUpload</span><span class="p">(</span>
            <span class="n">accept</span><span class="o">=</span><span class="s2">&quot;.json&quot;</span><span class="p">,</span>
            <span class="n">multiple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;button_color&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;theme_color&quot;</span><span class="p">]},</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Load local network connectivity&quot;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;btn_full_w&quot;</span><span class="p">],</span>
            <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_drives_button</span> <span class="o">=</span> <span class="n">FileUpload</span><span class="p">(</span>
            <span class="n">accept</span><span class="o">=</span><span class="s2">&quot;.json&quot;</span><span class="p">,</span>
            <span class="n">multiple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;button_color&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;theme_color&quot;</span><span class="p">]},</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Load external drives&quot;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;btn&quot;</span><span class="p">],</span>
            <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delete_drive_button</span> <span class="o">=</span> <span class="n">create_expanded_button</span><span class="p">(</span>
            <span class="s2">&quot;Delete all drives&quot;</span><span class="p">,</span>
            <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;btn&quot;</span><span class="p">],</span>
            <span class="n">button_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;theme_color&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cell_type_radio_buttons</span> <span class="o">=</span> <span class="n">RadioButtons</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;L2/3 Pyramidal&quot;</span><span class="p">,</span> <span class="s2">&quot;L5 Pyramidal&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Cell type:&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cell_layer_radio_buttons</span> <span class="o">=</span> <span class="n">RadioButtons</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;Synapses&quot;</span><span class="p">,</span> <span class="s2">&quot;Biophysics&quot;</span><span class="p">],</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Cell Properties:&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Plotting window</span>

        <span class="c1"># Visualization figure related dicts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_outputs_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_dropdown_types_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_sim_selections_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># Add drive section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_widgets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_boxes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_accordion</span> <span class="o">=</span> <span class="n">Accordion</span><span class="p">()</span>

        <span class="c1"># Connectivity list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_widgets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="c1"># Cell parameter dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_parameters_widgets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># Synaptic Gains dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_gain_widgets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_ui_components</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_logging_window_logger</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_backend</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks for MPI and returns the default backend name&quot;&quot;&quot;</span>
        <span class="n">default_backend</span> <span class="o">=</span> <span class="s2">&quot;Joblib&quot;</span>
        <span class="k">if</span> <span class="n">_has_mpi4py</span><span class="p">()</span> <span class="ow">and</span> <span class="n">_has_psutil</span><span class="p">():</span>
            <span class="n">default_backend</span> <span class="o">=</span> <span class="s2">&quot;MPI&quot;</span>
        <span class="k">return</span> <span class="n">default_backend</span>

<div class="viewcode-block" id="HNNGUI.get_cell_parameters_dict">
<a class="viewcode-back" href="../../../generated/hnn_core.gui.HNNGUI.html#hnn_core.gui.HNNGUI.get_cell_parameters_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cell_parameters_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the number of elements in the</span>
<span class="sd">        cell_parameters_dict dictionary.</span>
<span class="sd">        This is for testing purposes&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cell_parameters_dict</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_init_html_download_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">mimetype</span><span class="p">):</span>
        <span class="n">b64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">b64</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="c1"># Initialliting HTML code for download button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_download_button</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;a download=&quot;</span><span class="si">{filename}</span><span class="s2">&quot; href=&quot;data:</span><span class="si">{mimetype}</span><span class="s2">;base64,</span><span class="si">{payload}</span><span class="s2">&quot;</span>
<span class="s2">          download&gt;</span>
<span class="s2">        &lt;button style=&quot;background:</span><span class="si">{color_theme}</span><span class="s2">; height:</span><span class="si">{btn_height}</span><span class="s2">&quot;</span>
<span class="s2">        class=&quot; jupyter-button</span>
<span class="s2">           mod-warning&quot; </span><span class="si">{is_disabled}</span><span class="s2"> &gt;</span><span class="si">{title}</span><span class="s2">&lt;/button&gt;</span>
<span class="s2">        &lt;/a&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="c1"># Create widget wrapper</span>
        <span class="k">return</span> <span class="n">HTML</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">html_download_button</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;&quot;</span><span class="p">},</span>
                <span class="n">is_disabled</span><span class="o">=</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
                <span class="n">btn_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;run_btn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                <span class="n">color_theme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;theme_color&quot;</span><span class="p">],</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_logging_window_logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">_OutputWidgetHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_out</span><span class="p">)</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2">  - [</span><span class="si">%(levelname)s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_ui_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize larger UI components and dynamical output windows.</span>

<span class="sd">        It&#39;s not encouraged for users to modify or access attributes in this</span>
<span class="sd">        part.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># dynamic larger components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drives_out</span> <span class="o">=</span> <span class="n">Output</span><span class="p">()</span>  <span class="c1"># tab to add new drives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connectivity_out</span> <span class="o">=</span> <span class="n">Output</span><span class="p">()</span>  <span class="c1"># tab to tune connectivity.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cell_params_out</span> <span class="o">=</span> <span class="n">Output</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_global_gain_out</span> <span class="o">=</span> <span class="n">Output</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log_out</span> <span class="o">=</span> <span class="n">Output</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">viz_manager</span> <span class="o">=</span> <span class="n">_VizManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_default_params</span><span class="p">)</span>

        <span class="c1"># detailed configuration of backends</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backend_config_out</span> <span class="o">=</span> <span class="n">Output</span><span class="p">()</span>

        <span class="c1"># static parts</span>
        <span class="c1"># Running status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_simulation_status_bar</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_simulation_status_contents</span><span class="p">[</span><span class="s2">&quot;not_running&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log_window</span> <span class="o">=</span> <span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_out</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;log_out&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operation_buttons</span> <span class="o">=</span> <span class="n">HBox</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_button</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_data_button</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_config_button</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_simuation_button</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simulation_list_widget</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;operation_box&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="c1"># title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;div</span>
<span class="s2">            style=&#39;background:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;theme_color&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            text-align:center;color:white;&#39;&gt;</span>
<span class="s2">            HUMAN NEOCORTICAL NEUROSOLVER&lt;/div&gt;&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">analysis_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Provides everything viz window needs except for the data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;viz_style&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;visualization_output&quot;</span><span class="p">],</span>
            <span class="c1"># widgets</span>
            <span class="s2">&quot;plot_outputs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_outputs_dict</span><span class="p">,</span>
            <span class="s2">&quot;plot_dropdowns&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_dropdown_types_dict</span><span class="p">,</span>
            <span class="s2">&quot;plot_sim_selections&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_sim_selections_dict</span><span class="p">,</span>
            <span class="s2">&quot;current_sim_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_simulation_name</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Provides easy access to simulation-related data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;simulation_data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span><span class="p">}</span>

<div class="viewcode-block" id="HNNGUI.load_parameters">
<a class="viewcode-back" href="../../../generated/hnn_core.gui.HNNGUI.html#hnn_core.gui.HNNGUI.load_parameters">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_parameters</span><span class="p">(</span><span class="n">params_fname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read parameters from file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">params_fname</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parameters</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_link_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Link callbacks to UI components.&quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_handle_backend_change</span><span class="p">(</span><span class="n">backend_type</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">handle_backend_change</span><span class="p">(</span>
                <span class="n">backend_type</span><span class="o">.</span><span class="n">new</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_backend_config_out</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_mpi_cmd</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_n_jobs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_add_drive_button_clicked</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_location_selection</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_drive_widget</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_drive_type_selection</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">location</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_delete_drives_clicked</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_drives_out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
            <span class="c1"># black magic: the following does not work</span>
            <span class="c1"># global drive_widgets; drive_widgets = list()</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drive_widgets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drive_widgets</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drive_boxes</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_on_upload_connectivity</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
            <span class="n">new_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_upload_params_change</span><span class="p">(</span>
                <span class="n">change</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;drive_textbox&quot;</span><span class="p">],</span> <span class="n">load_type</span><span class="o">=</span><span class="s2">&quot;connectivity&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">new_params</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_on_upload_drives</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_upload_params_change</span><span class="p">(</span>
                <span class="n">change</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;drive_textbox&quot;</span><span class="p">],</span> <span class="n">load_type</span><span class="o">=</span><span class="s2">&quot;drives&quot;</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_on_upload_data</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">on_upload_data_change</span><span class="p">(</span>
                <span class="n">change</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_manager</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_out</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_run_button_clicked</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">run_button_clicked</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_simulation_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_out</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drive_widgets</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_dt</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_tstop</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig_default_params</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_default_smoothing</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_default_scaling</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_min_frequency</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_max_frequency</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_ntrials</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_backend_selection</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_mpi_cmd</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_n_jobs</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_simulation_status_bar</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_simulation_status_contents</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_widgets</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viz_manager</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simulation_list_widget</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_parameters_widgets</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">global_gain_widgets</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_simulation_list_change</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># Simulation Data</span>
            <span class="n">_simulation_data</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">_serialize_simulation</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_list_widget</span>
            <span class="p">)</span>

            <span class="n">result_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">new</span><span class="si">}{</span><span class="n">file_extension</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s2">&quot;.csv&quot;</span><span class="p">:</span>
                <span class="n">b64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">_simulation_data</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">_simulation_data</span><span class="p">)</span>

            <span class="n">payload</span> <span class="o">=</span> <span class="n">b64</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_simuation_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_download_button</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">result_file</span><span class="p">,</span>
                <span class="n">is_disabled</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">btn_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;run_btn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                <span class="n">color_theme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;theme_color&quot;</span><span class="p">],</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Save Simulation&quot;</span><span class="p">,</span>
                <span class="n">mimetype</span><span class="o">=</span><span class="s2">&quot;text/csv&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Network Configuration</span>
            <span class="n">network_config</span> <span class="o">=</span> <span class="n">_serialize_config</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_list_widget</span>
            <span class="p">)</span>
            <span class="n">b64_net</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">network_config</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_config_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_download_button</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">payload</span><span class="o">=</span><span class="n">b64_net</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
                <span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">new</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">,</span>
                <span class="n">is_disabled</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">btn_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;run_btn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                <span class="n">color_theme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;theme_color&quot;</span><span class="p">],</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Save Network&quot;</span><span class="p">,</span>
                <span class="n">mimetype</span><span class="o">=</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_driver_type_change</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widget_location_selection</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="p">(</span>
                <span class="kc">True</span> <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">new</span> <span class="o">==</span> <span class="s2">&quot;Tonic&quot;</span> <span class="k">else</span> <span class="kc">False</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_cell_type_radio_change</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">_update_cell_params_vbox</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cell_params_out</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_parameters_widgets</span><span class="p">,</span>
                <span class="n">value</span><span class="o">.</span><span class="n">new</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_layer_radio_buttons</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_cell_layer_radio_change</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">_update_cell_params_vbox</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cell_params_out</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_parameters_widgets</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_type_radio_buttons</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">value</span><span class="o">.</span><span class="n">new</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">widget_backend_selection</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">_handle_backend_change</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_drive_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">_add_drive_button_clicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_drive_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">_delete_drives_clicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_connectivity_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">_on_upload_connectivity</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_drives_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">_on_upload_drives</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">_run_button_clicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">_on_upload_data</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_list_widget</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">_simulation_list_change</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget_drive_type_selection</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">_driver_type_change</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cell_type_radio_buttons</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">_cell_type_radio_change</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_layer_radio_buttons</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">_cell_layer_radio_change</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_delete_single_drive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drive_accordion</span><span class="o">.</span><span class="n">selected_index</span>

        <span class="c1"># Remove selected drive from drive lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_boxes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_widgets</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Rebuild the accordion collection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_accordion</span><span class="o">.</span><span class="n">titles</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">t</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drive_accordion</span><span class="o">.</span><span class="n">titles</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">index</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_accordion</span><span class="o">.</span><span class="n">selected_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_accordion</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drive_boxes</span>

        <span class="c1"># Render</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drives_out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drives_out</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drive_accordion</span><span class="p">)</span>

<div class="viewcode-block" id="HNNGUI.compose">
<a class="viewcode-back" href="../../../generated/hnn_core.gui.HNNGUI.html#hnn_core.gui.HNNGUI.compose">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compose widgets.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        return_layout : bool</span>
<span class="sd">            If the method returns the layout object which can be rendered by</span>
<span class="sd">            IPython.display.display() method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">box_style</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            style=&quot;</span>
<span class="s2">                background: gray;</span>
<span class="s2">                color: white;</span>
<span class="s2">                # font-weight: bold;</span>
<span class="s2">                width: 290px;</span>
<span class="s2">                padding: 0px 5px;</span>
<span class="s2">                margin-bottom: 2px;</span>
<span class="s2">            &quot;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">simulation_box</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;div </span><span class="si">{</span><span class="n">box_style</span><span class="si">}</span><span class="s2">&gt;Simulation Parameters&lt;/div&gt;&quot;</span><span class="p">),</span>
                <span class="n">VBox</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">widget_simulation_name</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">widget_tstop</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">widget_dt</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">widget_ntrials</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">widget_backend_selection</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_backend_config_out</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">),</span>
                <span class="n">Box</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="s2">&quot;20px&quot;</span><span class="p">)),</span>
                <span class="n">HTML</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&lt;div </span><span class="si">{</span><span class="n">box_style</span><span class="si">}</span><span class="s2">&#39;&gt;Default Visualization Parameters&lt;/div&gt;&quot;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">VBox</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">widget_default_smoothing</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">widget_default_scaling</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">widget_min_frequency</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">widget_max_frequency</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">),</span>
            <span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;config_box&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="c1"># Displays the default backend options</span>
        <span class="n">handle_backend_change</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widget_backend_selection</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_backend_config_out</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widget_mpi_cmd</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widget_n_jobs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">connectivity_configuration</span> <span class="o">=</span> <span class="n">Tab</span><span class="p">()</span>

        <span class="n">connectivity_box</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">HBox</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">load_connectivity_button</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">),</span>
                <span class="n">VBox</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_global_gain_out</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_connectivity_out</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">cell_parameters</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_type_radio_buttons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_layer_radio_buttons</span><span class="p">]),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cell_params_out</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">connectivity_configuration</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">connectivity_box</span><span class="p">,</span>
            <span class="n">cell_parameters</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">connectivity_configuration</span><span class="o">.</span><span class="n">titles</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Connectivity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Cell parameters&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">drive_selections</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_drive_button</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_drive_type_selection</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_location_selection</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">flex</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">drives_options</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">HBox</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">VBox</span><span class="p">(</span>
                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">load_drives_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_drive_button</span><span class="p">],</span>
                            <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">flex</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">),</span>
                        <span class="p">),</span>
                        <span class="n">drive_selections</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_drives_out</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">config_panel</span><span class="p">,</span> <span class="n">figs_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz_manager</span><span class="o">.</span><span class="n">compose</span><span class="p">()</span>

        <span class="c1"># Tabs for left pane</span>
        <span class="n">left_tab</span> <span class="o">=</span> <span class="n">Tab</span><span class="p">()</span>
        <span class="n">left_tab</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">simulation_box</span><span class="p">,</span>
            <span class="n">connectivity_configuration</span><span class="p">,</span>
            <span class="n">drives_options</span><span class="p">,</span>
            <span class="n">config_panel</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Simulation&quot;</span><span class="p">,</span> <span class="s2">&quot;Network&quot;</span><span class="p">,</span> <span class="s2">&quot;External drives&quot;</span><span class="p">,</span> <span class="s2">&quot;Visualization&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">titles</span><span class="p">):</span>
            <span class="n">left_tab</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">app_layout</span> <span class="o">=</span> <span class="n">AppLayout</span><span class="p">(</span>
            <span class="n">header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">,</span>
            <span class="n">left_sidebar</span><span class="o">=</span><span class="n">VBox</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">VBox</span><span class="p">([</span><span class="n">left_tab</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;left_tab&quot;</span><span class="p">]),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_operation_buttons</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log_window</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;left_sidebar&quot;</span><span class="p">],</span>
            <span class="p">),</span>
            <span class="n">right_sidebar</span><span class="o">=</span><span class="n">figs_output</span><span class="p">,</span>
            <span class="n">footer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_simulation_status_bar</span><span class="p">,</span>
            <span class="n">pane_widths</span><span class="o">=</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;left_sidebar&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="s2">&quot;0px&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;visualization_window&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">pane_heights</span><span class="o">=</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;header_height&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;visualization_window&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;simulation_status_height&quot;</span><span class="p">],</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_link_callbacks</span><span class="p">()</span>

        <span class="c1"># initialize drive and connectivity ipywidgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_drive_and_connectivity</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_layout</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_layout</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_layout</span><span class="p">)</span>

<div class="viewcode-block" id="HNNGUI.capture">
<a class="viewcode-back" href="../../../generated/hnn_core.gui.HNNGUI.html#hnn_core.gui.HNNGUI.capture">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra_margin</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">render</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take a screenshot of the current GUI.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        width : int | None</span>
<span class="sd">            The width of iframe window use to show the snapshot.</span>
<span class="sd">        height : int | None</span>
<span class="sd">            The height of iframe window use to show the snapshot.</span>
<span class="sd">        extra_margin: int</span>
<span class="sd">            Extra margin in pixel for the GUI.</span>
<span class="sd">        render : bool</span>
<span class="sd">            Will return an IFrame object if False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        snapshot : An iframe snapshot object that can be rendered in notebooks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">embed_minimal_html</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">views</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app_layout</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">width</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_width</span> <span class="o">+</span> <span class="n">extra_margin</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">height</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_height</span> <span class="o">+</span> <span class="n">extra_margin</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span>
        <span class="n">data_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;data:text/html,</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="n">IFrame</span><span class="p">(</span><span class="n">data_url</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">render</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="n">screenshot</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">screenshot</span></div>


<div class="viewcode-block" id="HNNGUI.run_notebook_cells">
<a class="viewcode-back" href="../../../generated/hnn_core.gui.HNNGUI.html#hnn_core.gui.HNNGUI.run_notebook_cells">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_notebook_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all but the last cells sequentially in a Jupyter notebook.</span>

<span class="sd">        To properly use this function:</span>
<span class="sd">            1. Put this into the penultimate cell.</span>
<span class="sd">            2. init the HNNGUI in a single cell.</span>
<span class="sd">            3. Hit &#39;run all&#39; button to run the whole notebook and it will</span>
<span class="sd">               selectively run twice.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">js_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        function sleep(ms) {</span>
<span class="s2">        return new Promise(resolve =&gt; setTimeout(resolve, ms));</span>
<span class="s2">        }</span>
<span class="s2">        function getRunningStatus(idx){</span>
<span class="s2">            const htmlContent = Jupyter.notebook.get_cell(idx).element[0];</span>
<span class="s2">            return htmlContent.childNodes[0].childNodes[0].textContent;</span>
<span class="s2">        }</span>
<span class="s2">        function cellContainsInitOrMarkdown(idx){</span>
<span class="s2">            const cell = Jupyter.notebook.get_cell(idx);</span>
<span class="s2">            if(cell.cell_type!==&#39;code&#39;){</span>
<span class="s2">                return true;</span>
<span class="s2">            }</span>
<span class="s2">            else{</span>
<span class="s2">                const textVal = cell.element[0].childNodes[0].textContent;</span>
<span class="s2">                return textVal.includes(&#39;HNNGUI()&#39;) || textVal.includes(</span>
<span class="s2">                    &#39;HNNGUI&#39;);</span>
<span class="s2">            }</span>
<span class="s2">        }</span>
<span class="s2">        function cellContainsRunCells(idx){</span>
<span class="s2">            const textVal = Jupyter.notebook.get_cell(</span>
<span class="s2">                idx).element[0].childNodes[0].textContent;</span>
<span class="s2">            return textVal.includes(&#39;run_notebook_cells()&#39;);</span>
<span class="s2">        }</span>
<span class="s2">        async function runNotebook() {</span>
<span class="s2">            console.log(&quot;run notebook cell by cell&quot;);</span>
<span class="s2">            const cellHtmlContents = Jupyter.notebook.element[0].children[0];</span>
<span class="s2">            const nCells = cellHtmlContents.childElementCount;</span>
<span class="s2">            console.log(`In total we have $</span><span class="si">{nCells}</span><span class="s2"> cells`);</span>

<span class="s2">            for(let i=1; i&lt;nCells-1; i++){</span>
<span class="s2">                if(cellContainsRunCells(i)){</span>
<span class="s2">                    break</span>
<span class="s2">                }</span>
<span class="s2">                else if(cellContainsInitOrMarkdown(i)){</span>
<span class="s2">                    console.log(`Skip init or markdown cell $</span><span class="si">{i}</span><span class="s2">...`);</span>
<span class="s2">                    continue</span>
<span class="s2">                }</span>
<span class="s2">                else{</span>
<span class="s2">                    console.log(`About to execute cell $</span><span class="si">{i}</span><span class="s2">..`);</span>
<span class="s2">                    Jupyter.notebook.execute_cells([i]);</span>
<span class="s2">                    while (getRunningStatus(i).includes(&quot;*&quot;)){</span>
<span class="s2">                        console.log(&quot;Still running, wait for another 2 secs&quot;);</span>
<span class="s2">                        await sleep(2000);</span>
<span class="s2">                    }</span>
<span class="s2">                    await sleep(1000);</span>
<span class="s2">                }</span>
<span class="s2">            }</span>
<span class="s2">            console.log(&#39;Done&#39;);</span>
<span class="s2">        }</span>
<span class="s2">        runNotebook();</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">js_string</span></div>


    <span class="c1"># below are a series of methods that are used to manipulate the GUI</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_simulate_upload_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_url</span><span class="p">):</span>
        <span class="n">uploaded_value</span> <span class="o">=</span> <span class="n">_prepare_upload_file</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data_button</span><span class="o">.</span><span class="n">set_trait</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">uploaded_value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_simulate_upload_connectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_url</span><span class="p">):</span>
        <span class="n">uploaded_value</span> <span class="o">=</span> <span class="n">_prepare_upload_file</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_connectivity_button</span><span class="o">.</span><span class="n">set_trait</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">uploaded_value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_simulate_upload_drives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_url</span><span class="p">):</span>
        <span class="n">uploaded_value</span> <span class="o">=</span> <span class="n">_prepare_upload_file</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_drives_button</span><span class="o">.</span><span class="n">set_trait</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">uploaded_value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_simulate_left_tab_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab_title</span><span class="p">):</span>
        <span class="c1"># Get left tab group object</span>
        <span class="n">left_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_layout</span><span class="o">.</span><span class="n">left_sidebar</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Check that the title is in the tab group</span>
        <span class="k">if</span> <span class="n">tab_title</span> <span class="ow">in</span> <span class="n">left_tab</span><span class="o">.</span><span class="n">titles</span><span class="p">:</span>
            <span class="c1"># Simulate the user clicking on the tab</span>
            <span class="n">left_tab</span><span class="o">.</span><span class="n">selected_index</span> <span class="o">=</span> <span class="n">left_tab</span><span class="o">.</span><span class="n">titles</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">tab_title</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Tab title does not exist.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_simulate_make_figure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_left_tab_click</span><span class="p">(</span><span class="s2">&quot;Visualization&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viz_manager</span><span class="o">.</span><span class="n">make_fig_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_simulate_viz_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A shortcut to call simulated actions in _VizManager.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        action_name : str</span>
<span class="sd">            The action to take. For example, to call `_simulate_add_fig` in</span>
<span class="sd">            _VizManager, you can run `_simulate_viz_action(&quot;add_fig&quot;)`</span>
<span class="sd">        args : list</span>
<span class="sd">            Optional positional parameters passed to the called method.</span>
<span class="sd">        kwargs: dict</span>
<span class="sd">            Optional keyword parameters passed to the called method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_left_tab_click</span><span class="p">(</span><span class="s2">&quot;Visualization&quot;</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viz_manager</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_simulate_</span><span class="si">{</span><span class="n">action_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">action</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_simulate_delete_single_drive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_accordion</span><span class="o">.</span><span class="n">selected_index</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_boxes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

<div class="viewcode-block" id="HNNGUI.load_drive_and_connectivity">
<a class="viewcode-back" href="../../../generated/hnn_core.gui.HNNGUI.html#hnn_core.gui.HNNGUI.load_drive_and_connectivity">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_drive_and_connectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add drive and connectivity ipywidgets from params.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_out</span><span class="p">:</span>
            <span class="c1"># Add connectivity</span>
            <span class="n">add_connectivity_tab</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_connectivity_out</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_widgets</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cell_params_out</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_parameters_widgets</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_layer_radio_buttons</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_type_radio_buttons</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_global_gain_out</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">global_gain_widgets</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Add drives</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_drive_tab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="HNNGUI.add_drive_widget">
<a class="viewcode-back" href="../../../generated/hnn_core.gui.HNNGUI.html#hnn_core.gui.HNNGUI.add_drive_widget">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_drive_widget</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">drive_type</span><span class="p">,</span>
        <span class="n">location</span><span class="p">,</span>
        <span class="n">prespecified_drive_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">prespecified_drive_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">prespecified_weights_ampa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">prespecified_weights_nmda</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">prespecified_delays</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">prespecified_n_drive_cells</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">prespecified_cell_specific</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">render</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">expand_last_drive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">event_seed</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a widget for a new drive.&quot;&quot;&quot;</span>

        <span class="c1"># Check only adds 1 tonic input widget</span>
        <span class="k">if</span> <span class="n">drive_type</span> <span class="o">==</span> <span class="s2">&quot;Tonic&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_is_valid_add_tonic_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drive_widgets</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Build drive widget objects</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">drive_type</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drive_boxes</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">prespecified_drive_name</span>
            <span class="k">else</span> <span class="n">prespecified_drive_name</span>
        <span class="p">)</span>
        <span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;125px&quot;</span><span class="p">}</span>
        <span class="n">prespecified_drive_data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{}</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">prespecified_drive_data</span> <span class="k">else</span> <span class="n">prespecified_drive_data</span>
        <span class="p">)</span>
        <span class="n">prespecified_drive_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;seedcore&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">event_seed</span><span class="p">,</span> <span class="mi">2</span><span class="p">)})</span>

        <span class="n">drive</span><span class="p">,</span> <span class="n">drive_box</span> <span class="o">=</span> <span class="n">_build_drive_objects</span><span class="p">(</span>
            <span class="n">drive_type</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widget_tstop</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;drive_textbox&quot;</span><span class="p">],</span>
            <span class="n">style</span><span class="p">,</span>
            <span class="n">location</span><span class="p">,</span>
            <span class="n">prespecified_drive_data</span><span class="p">,</span>
            <span class="n">prespecified_weights_ampa</span><span class="p">,</span>
            <span class="n">prespecified_weights_nmda</span><span class="p">,</span>
            <span class="n">prespecified_delays</span><span class="p">,</span>
            <span class="n">prespecified_n_drive_cells</span><span class="p">,</span>
            <span class="n">prespecified_cell_specific</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Add delete button and assign its call-back function</span>
        <span class="n">delete_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Delete&quot;</span><span class="p">,</span>
            <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;danger&quot;</span><span class="p">,</span>
            <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;close&quot;</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="s2">&quot;del_fig_btn&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">delete_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_delete_single_drive</span><span class="p">)</span>
        <span class="n">drive_box</span><span class="o">.</span><span class="n">children</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">HTML</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;&lt;p&gt; &lt;/p&gt;&quot;</span><span class="p">),</span>  <span class="c1"># Adds blank space</span>
            <span class="n">delete_button</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">drive_boxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drive_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_widgets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">render</span><span class="p">:</span>
            <span class="c1"># Construct accordion object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drive_accordion</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drive_boxes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drive_accordion</span><span class="o">.</span><span class="n">selected_index</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drive_boxes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">expand_last_drive</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="c1"># Update accordion title with location</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">drive</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drive_widgets</span><span class="p">):</span>
                <span class="n">tab_name</span> <span class="o">=</span> <span class="n">drive</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">drive</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Tonic&quot;</span><span class="p">:</span>
                    <span class="n">tab_name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">drive</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drive_accordion</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">tab_name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_drives_out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drives_out</span><span class="p">:</span>
                <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drive_accordion</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">add_drive_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">dict_to_network</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">drive_specs</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">external_drives</span>
        <span class="n">tonic_specs</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">external_biases</span>

        <span class="c1"># clear before adding drives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drives_out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drive_widgets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drive_widgets</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drive_boxes</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="n">drive_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">drive_specs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># Add tonic biases</span>
        <span class="k">if</span> <span class="n">tonic_specs</span><span class="p">:</span>
            <span class="n">drive_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tonic_specs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">drive_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">drive_names</span><span class="p">):</span>  <span class="c1"># order matters</span>
            <span class="k">if</span> <span class="s2">&quot;tonic&quot;</span> <span class="ow">in</span> <span class="n">drive_name</span><span class="p">:</span>
                <span class="n">specs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;tonic&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">prespecified_drive_data</span><span class="o">=</span><span class="n">tonic_specs</span><span class="p">[</span><span class="n">drive_name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">specs</span> <span class="o">=</span> <span class="n">drive_specs</span><span class="p">[</span><span class="n">drive_name</span><span class="p">]</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">prespecified_drive_data</span><span class="o">=</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;dynamics&quot;</span><span class="p">],</span>
                    <span class="n">prespecified_weights_ampa</span><span class="o">=</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weights_ampa&quot;</span><span class="p">],</span>
                    <span class="n">prespecified_weights_nmda</span><span class="o">=</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weights_nmda&quot;</span><span class="p">],</span>
                    <span class="n">prespecified_delays</span><span class="o">=</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;synaptic_delays&quot;</span><span class="p">],</span>
                    <span class="n">prespecified_n_drive_cells</span><span class="o">=</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;n_drive_cells&quot;</span><span class="p">],</span>
                    <span class="n">prespecified_cell_specific</span><span class="o">=</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cell_specific&quot;</span><span class="p">],</span>
                    <span class="n">event_seed</span><span class="o">=</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;event_seed&quot;</span><span class="p">],</span>
                <span class="p">)</span>

            <span class="n">should_render</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">drive_names</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_drive_widget</span><span class="p">(</span>
                <span class="n">drive_type</span><span class="o">=</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span>
                <span class="n">location</span><span class="o">=</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">],</span>
                <span class="n">prespecified_drive_name</span><span class="o">=</span><span class="n">drive_name</span><span class="p">,</span>
                <span class="n">render</span><span class="o">=</span><span class="n">should_render</span><span class="p">,</span>
                <span class="n">expand_last_drive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_upload_params_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">load_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">change</span><span class="p">[</span><span class="s2">&quot;owner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">file_contents</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_out</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">file_contents</span><span class="p">)</span>

            <span class="c1"># update simulation settings and params</span>
            <span class="k">if</span> <span class="s2">&quot;tstop&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_tstop</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;dt&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget_dt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span>

            <span class="c1"># init network, add drives &amp; connectivity</span>
            <span class="k">if</span> <span class="n">load_type</span> <span class="o">==</span> <span class="s2">&quot;connectivity&quot;</span><span class="p">:</span>
                <span class="n">add_connectivity_tab</span><span class="p">(</span>
                    <span class="n">params</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_connectivity_out</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connectivity_widgets</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_cell_params_out</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cell_parameters_widgets</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cell_layer_radio_buttons</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cell_type_radio_buttons</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_global_gain_out</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_gain_widgets</span><span class="p">,</span>
                    <span class="n">layout</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">load_type</span> <span class="o">==</span> <span class="s2">&quot;drives&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_drive_tab</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">load_type</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Resets file counter to 0</span>
        <span class="n">change</span><span class="p">[</span><span class="s2">&quot;owner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_trait</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="p">([]))</span>
        <span class="k">return</span> <span class="n">params</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_prepare_upload_file_from_local</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)</span>

    <span class="n">upload_structure</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span>
            <span class="s2">&quot;last_modified&quot;</span><span class="p">:</span> <span class="n">last_modified</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">upload_structure</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_prepare_upload_file_from_url</span><span class="p">(</span><span class="n">file_url</span><span class="p">):</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">content</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="n">upload_structure</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">file_url</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
            <span class="s2">&quot;last_modified&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
        <span class="p">}</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">upload_structure</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_prepare_upload_file</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulates output of the FileUpload widget for testing.</span>

<span class="sd">    Unit tests for the GUI simulate user upload of files. File source can</span>
<span class="sd">    either be local or from a URL. This function returns the data structure</span>
<span class="sd">    of the ipywidget FileUpload widget, a list of dictionaries with file</span>
<span class="sd">    attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">uploaded_value</span> <span class="o">=</span> <span class="n">_prepare_upload_file_from_local</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
        <span class="n">uploaded_value</span> <span class="o">=</span> <span class="n">_prepare_upload_file_from_url</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">uploaded_value</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_update_nested_dict</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">skip_none</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates dictionary values from another dictionary</span>

<span class="sd">    Will update nested dictionaries in the structure. New items from the</span>
<span class="sd">    update dictionary are added and omitted items are retained from the</span>
<span class="sd">    original dictionary. By default, will not pass None values from the update</span>
<span class="sd">    dictionary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    original : dict</span>
<span class="sd">        Dictionary to update</span>
<span class="sd">    new : dict</span>
<span class="sd">        Dictionary with new values for updating</span>
<span class="sd">    skip_none : bool, default True</span>
<span class="sd">        None values in the new dictionary are not passed to the updated</span>
<span class="sd">        dictionary by when True. If False None values will be passed to the</span>
<span class="sd">        updated dictionary.</span>

<span class="sd">    Returns dict</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">updated</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">updated</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">updated</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_update_nested_dict</span><span class="p">(</span><span class="n">updated</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="p">,</span> <span class="n">skip_none</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">skip_none</span><span class="p">):</span>
            <span class="n">updated</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">return</span> <span class="n">updated</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_expanded_button</span><span class="p">(</span>
    <span class="n">description</span><span class="p">,</span> <span class="n">button_style</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">button_color</span><span class="o">=</span><span class="s2">&quot;#8A2BE2&quot;</span>
<span class="p">):</span>
    <span class="k">return</span> <span class="n">Button</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="n">button_style</span><span class="o">=</span><span class="n">button_style</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;button_color&quot;</span><span class="p">:</span> <span class="n">button_color</span><span class="p">},</span>
        <span class="n">disabled</span><span class="o">=</span><span class="n">disabled</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_connectivity_widgets</span><span class="p">(</span><span class="n">conn_data</span><span class="p">,</span> <span class="n">global_gain_textfields</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create connectivity box widgets from specified weight and gains&quot;&quot;&quot;</span>
    <span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;100px&quot;</span><span class="p">}</span>
    <span class="n">html_tab</span> <span class="o">=</span> <span class="s2">&quot;&amp;emsp;&quot;</span>

    <span class="n">sliders</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">receptor_idx</span><span class="p">,</span> <span class="n">receptor_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">conn_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">global_gain_type</span> <span class="o">=</span> <span class="n">global_gain_type_lookup_dict</span><span class="p">[</span>
            <span class="p">(</span>
                <span class="n">conn_data</span><span class="p">[</span><span class="n">receptor_name</span><span class="p">][</span><span class="s2">&quot;src_gids&quot;</span><span class="p">],</span>
                <span class="n">conn_data</span><span class="p">[</span><span class="n">receptor_name</span><span class="p">][</span><span class="s2">&quot;target_gids&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">]</span>

        <span class="n">weight_text_input</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">conn_data</span><span class="p">[</span><span class="n">receptor_name</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">],</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Weight:&quot;</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">single_gain_text_input</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">conn_data</span><span class="p">[</span><span class="n">receptor_name</span><span class="p">][</span><span class="s2">&quot;gain&quot;</span><span class="p">],</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Gain:&quot;</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">combined_gain_indicator_output</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;p style=&#39;margin:0px;padding-left:115px;&#39;&gt;</span>
<span class="s2">            &lt;b&gt;Total Computed Gain=</span><span class="si">{</span>
<span class="w">                </span><span class="p">(</span>
<span class="w">                    </span><span class="mi">1</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">global_gain_textfields</span><span class="p">[</span><span class="n">global_gain_type</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">single_gain_text_input</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&lt;/b&gt;&lt;/p&gt;&quot;&quot;&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Create closure to capture current widget references</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">make_update_gain_indicator</span><span class="p">(</span><span class="n">gain_output</span><span class="p">,</span> <span class="n">gain_input</span><span class="p">,</span> <span class="n">gain_type</span><span class="p">):</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">update_gain_indicator</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
                <span class="n">gain_output</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;p style=&#39;margin:0px;padding-left:115px;&#39;&gt;</span>
<span class="s2">                &lt;b&gt;Total Computed Gain=</span><span class="si">{</span>
<span class="w">                    </span><span class="p">(</span>
<span class="w">                        </span><span class="mi">1</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">global_gain_textfields</span><span class="p">[</span><span class="n">gain_type</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gain_input</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&lt;/b&gt;&lt;/p&gt;&quot;&quot;&quot;</span>

            <span class="k">return</span> <span class="n">update_gain_indicator</span>

        <span class="c1"># Connect the gain objects so they update each other</span>
        <span class="n">update_gain_indicator_fn</span> <span class="o">=</span> <span class="n">make_update_gain_indicator</span><span class="p">(</span>
            <span class="n">combined_gain_indicator_output</span><span class="p">,</span> <span class="n">single_gain_text_input</span><span class="p">,</span> <span class="n">global_gain_type</span>
        <span class="p">)</span>
        <span class="n">global_gain_textfields</span><span class="p">[</span><span class="n">global_gain_type</span><span class="p">]</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span>
            <span class="n">update_gain_indicator_fn</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;value&quot;</span>
        <span class="p">)</span>
        <span class="n">single_gain_text_input</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">update_gain_indicator_fn</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>

        <span class="c1"># Now, create the similar final Weight text output</span>
        <span class="n">final_weight_indicator_output</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;b&gt;Final Weight=</span><span class="si">{</span>
<span class="w">                </span><span class="p">(</span>
<span class="w">                    </span><span class="n">weight_text_input</span><span class="o">.</span><span class="n">value</span>
<span class="w">                    </span><span class="o">*</span><span class="w"> </span><span class="p">(</span>
<span class="w">                        </span><span class="mi">1</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">global_gain_textfields</span><span class="p">[</span><span class="n">global_gain_type</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">single_gain_text_input</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;/b&gt;&quot;&quot;&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Create closure to capture current widget references</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">make_update_weight_indicator</span><span class="p">(</span>
            <span class="n">weight_output</span><span class="p">,</span> <span class="n">weight_input</span><span class="p">,</span> <span class="n">gain_input</span><span class="p">,</span> <span class="n">gain_type</span>
        <span class="p">):</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">update_weight_indicator</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
                <span class="n">weight_output</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;b&gt;Final Weight=</span><span class="si">{</span>
<span class="w">                    </span><span class="p">(</span>
<span class="w">                        </span><span class="n">weight_input</span><span class="o">.</span><span class="n">value</span>
<span class="w">                        </span><span class="o">*</span><span class="w"> </span><span class="p">(</span>
<span class="w">                            </span><span class="mi">1</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">global_gain_textfields</span><span class="p">[</span><span class="n">gain_type</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">gain_input</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;/b&gt;&quot;&quot;&quot;</span>

            <span class="k">return</span> <span class="n">update_weight_indicator</span>

        <span class="c1"># Connect the weight and gain objects so they update each other</span>
        <span class="n">update_weight_indicator_fn</span> <span class="o">=</span> <span class="n">make_update_weight_indicator</span><span class="p">(</span>
            <span class="n">final_weight_indicator_output</span><span class="p">,</span>
            <span class="n">weight_text_input</span><span class="p">,</span>
            <span class="n">single_gain_text_input</span><span class="p">,</span>
            <span class="n">global_gain_type</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">global_gain_textfields</span><span class="p">[</span><span class="n">global_gain_type</span><span class="p">]</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span>
            <span class="n">update_weight_indicator_fn</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;value&quot;</span>
        <span class="p">)</span>
        <span class="n">single_gain_text_input</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">update_weight_indicator_fn</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="n">weight_text_input</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">update_weight_indicator_fn</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>

        <span class="n">display_name</span> <span class="o">=</span> <span class="n">conn_data</span><span class="p">[</span><span class="n">receptor_name</span><span class="p">][</span><span class="s2">&quot;receptor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="n">map_display_names</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;GABAA&quot;</span><span class="p">:</span> <span class="s2">&quot;GABA&lt;sub&gt;A&lt;/sub&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GABAB&quot;</span><span class="p">:</span> <span class="s2">&quot;GABA&lt;sub&gt;B&lt;/sub&gt;&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">display_name</span> <span class="ow">in</span> <span class="n">map_display_names</span><span class="p">:</span>
            <span class="n">display_name</span> <span class="o">=</span> <span class="n">map_display_names</span><span class="p">[</span><span class="n">display_name</span><span class="p">]</span>

        <span class="n">conn_widget</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">HTML</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;p style=&#39;margin:5px;&#39;&gt;&lt;b&gt;</span><span class="si">{</span><span class="n">html_tab</span><span class="si">}{</span><span class="n">html_tab</span><span class="si">}</span>
<span class="s2">            Receptor: </span><span class="si">{</span><span class="n">display_name</span><span class="si">}</span><span class="s2">&lt;/b&gt;&lt;/p&gt;&quot;&quot;&quot;</span>
                <span class="p">),</span>
                <span class="n">HBox</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">weight_text_input</span><span class="p">,</span>
                        <span class="n">final_weight_indicator_output</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">),</span>
                <span class="n">HBox</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">single_gain_text_input</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">),</span>
                <span class="n">combined_gain_indicator_output</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="c1">#  Add class to child Vboxes for targeted CSS</span>
        <span class="n">conn_widget</span><span class="o">.</span><span class="n">add_class</span><span class="p">(</span><span class="s2">&quot;connectivity-subsection&quot;</span><span class="p">)</span>
        <span class="n">conn_widget</span><span class="o">.</span><span class="n">_belongsto</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;receptor&quot;</span><span class="p">:</span> <span class="n">conn_data</span><span class="p">[</span><span class="n">receptor_name</span><span class="p">][</span><span class="s2">&quot;receptor&quot;</span><span class="p">],</span>
            <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="n">conn_data</span><span class="p">[</span><span class="n">receptor_name</span><span class="p">][</span><span class="s2">&quot;location&quot;</span><span class="p">],</span>
            <span class="s2">&quot;src_gids&quot;</span><span class="p">:</span> <span class="n">conn_data</span><span class="p">[</span><span class="n">receptor_name</span><span class="p">][</span><span class="s2">&quot;src_gids&quot;</span><span class="p">],</span>
            <span class="s2">&quot;target_gids&quot;</span><span class="p">:</span> <span class="n">conn_data</span><span class="p">[</span><span class="n">receptor_name</span><span class="p">][</span><span class="s2">&quot;target_gids&quot;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">sliders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conn_widget</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sliders</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_drive_weight_widgets</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">default_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;weights_ampa&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;L5_pyramidal&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;L2_pyramidal&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;L5_basket&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;L2_basket&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weights_nmda&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;L5_pyramidal&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;L2_pyramidal&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;L5_basket&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;L2_basket&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;delays&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;L5_pyramidal&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;L2_pyramidal&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;L5_basket&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;L2_basket&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">default_data</span> <span class="o">=</span> <span class="n">_update_nested_dict</span><span class="p">(</span><span class="n">default_data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
    <span class="n">cell_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;L5_pyramidal&quot;</span><span class="p">,</span> <span class="s2">&quot;L2_pyramidal&quot;</span><span class="p">,</span> <span class="s2">&quot;L5_basket&quot;</span><span class="p">,</span> <span class="s2">&quot;L2_basket&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">location</span> <span class="o">==</span> <span class="s2">&quot;distal&quot;</span><span class="p">:</span>
        <span class="n">cell_types</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;L5_basket&quot;</span><span class="p">)</span>

    <span class="n">weights_ampa</span><span class="p">,</span> <span class="n">weights_nmda</span><span class="p">,</span> <span class="n">delays</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">cell_types</span><span class="p">:</span>
        <span class="n">weights_ampa</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;weights_ampa&quot;</span><span class="p">][</span><span class="n">cell_type</span><span class="p">],</span>
            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_type</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">weights_nmda</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;weights_nmda&quot;</span><span class="p">][</span><span class="n">cell_type</span><span class="p">],</span>
            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_type</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">delays</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;delays&quot;</span><span class="p">][</span><span class="n">cell_type</span><span class="p">],</span>
            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_type</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">widgets_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;weights_ampa&quot;</span><span class="p">:</span> <span class="n">weights_ampa</span><span class="p">,</span>
        <span class="s2">&quot;weights_nmda&quot;</span><span class="p">:</span> <span class="n">weights_nmda</span><span class="p">,</span>
        <span class="s2">&quot;delays&quot;</span><span class="p">:</span> <span class="n">delays</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">widgets_list</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span><span class="n">HTML</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;&lt;b&gt;AMPA weights&lt;/b&gt;&quot;</span><span class="p">)]</span>
        <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">weights_ampa</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="o">+</span> <span class="p">[</span><span class="n">HTML</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;&lt;b&gt;NMDA weights&lt;/b&gt;&quot;</span><span class="p">)]</span>
        <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">weights_nmda</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="o">+</span> <span class="p">[</span><span class="n">HTML</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;&lt;b&gt;Synaptic delays&lt;/b&gt;&quot;</span><span class="p">)]</span>
        <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">delays</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">widgets_list</span><span class="p">,</span> <span class="n">widgets_dict</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_cell_spec_change</span><span class="p">(</span><span class="n">change</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_rhythmic_widget</span><span class="p">(</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">tstop_widget</span><span class="p">,</span>
    <span class="n">layout</span><span class="p">,</span>
    <span class="n">style</span><span class="p">,</span>
    <span class="n">location</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">weights_ampa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weights_nmda</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">delays</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">n_drive_cells</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cell_specific</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">default_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;tstart&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;tstart_std&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;tstop&quot;</span><span class="p">:</span> <span class="n">tstop_widget</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="s2">&quot;burst_rate&quot;</span><span class="p">:</span> <span class="mf">7.5</span><span class="p">,</span>
        <span class="s2">&quot;burst_std&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;numspikes&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;n_drive_cells&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;cell_specific&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;seedcore&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;n_drive_cells&quot;</span><span class="p">:</span> <span class="n">n_drive_cells</span><span class="p">,</span> <span class="s2">&quot;cell_specific&quot;</span><span class="p">:</span> <span class="n">cell_specific</span><span class="p">})</span>
    <span class="n">default_data</span> <span class="o">=</span> <span class="n">_update_nested_dict</span><span class="p">(</span><span class="n">default_data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
    <span class="n">tstart</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;tstart&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Start time (ms)&quot;</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tstart_std</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;tstart_std&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Start time dev (ms)&quot;</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tstop</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Stop time (ms)&quot;</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="n">tstop_widget</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">burst_rate</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;burst_rate&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Burst rate (Hz)&quot;</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">burst_std</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;burst_std&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Burst std dev (Hz)&quot;</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">numspikes</span> <span class="o">=</span> <span class="n">BoundedIntText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;numspikes&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;No. Spikes:&quot;</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e6</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">n_drive_cells</span> <span class="o">=</span> <span class="n">IntText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;n_drive_cells&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;No. Drive Cells:&quot;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;cell_specific&quot;</span><span class="p">],</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">cell_specific</span> <span class="o">=</span> <span class="n">Checkbox</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;cell_specific&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Cell-Specific&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="n">seedcore</span> <span class="o">=</span> <span class="n">IntText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;seedcore&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Seed&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">widgets_list</span><span class="p">,</span> <span class="n">widgets_dict</span> <span class="o">=</span> <span class="n">_get_drive_weight_widgets</span><span class="p">(</span>
        <span class="n">layout</span><span class="p">,</span>
        <span class="n">style</span><span class="p">,</span>
        <span class="n">location</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;weights_ampa&quot;</span><span class="p">:</span> <span class="n">weights_ampa</span><span class="p">,</span>
            <span class="s2">&quot;weights_nmda&quot;</span><span class="p">:</span> <span class="n">weights_nmda</span><span class="p">,</span>
            <span class="s2">&quot;delays&quot;</span><span class="p">:</span> <span class="n">delays</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>

    <span class="c1"># Disable n_drive_cells widget based on cell_specific checkbox</span>
    <span class="n">cell_specific</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span>
        <span class="n">partial</span><span class="p">(</span><span class="n">_cell_spec_change</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">n_drive_cells</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;value&quot;</span>
    <span class="p">)</span>

    <span class="n">drive_box</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">tstart</span><span class="p">,</span>
            <span class="n">tstart_std</span><span class="p">,</span>
            <span class="n">tstop</span><span class="p">,</span>
            <span class="n">burst_rate</span><span class="p">,</span>
            <span class="n">burst_std</span><span class="p">,</span>
            <span class="n">numspikes</span><span class="p">,</span>
            <span class="n">n_drive_cells</span><span class="p">,</span>
            <span class="n">cell_specific</span><span class="p">,</span>
            <span class="n">seedcore</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="o">+</span> <span class="n">widgets_list</span>
    <span class="p">)</span>

    <span class="n">drive</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Rhythmic&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">tstart</span><span class="o">=</span><span class="n">tstart</span><span class="p">,</span>
        <span class="n">tstart_std</span><span class="o">=</span><span class="n">tstart_std</span><span class="p">,</span>
        <span class="n">burst_rate</span><span class="o">=</span><span class="n">burst_rate</span><span class="p">,</span>
        <span class="n">burst_std</span><span class="o">=</span><span class="n">burst_std</span><span class="p">,</span>
        <span class="n">numspikes</span><span class="o">=</span><span class="n">numspikes</span><span class="p">,</span>
        <span class="n">seedcore</span><span class="o">=</span><span class="n">seedcore</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
        <span class="n">tstop</span><span class="o">=</span><span class="n">tstop</span><span class="p">,</span>
        <span class="n">n_drive_cells</span><span class="o">=</span><span class="n">n_drive_cells</span><span class="p">,</span>
        <span class="n">is_cell_specific</span><span class="o">=</span><span class="n">cell_specific</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">drive</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">widgets_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">drive</span><span class="p">,</span> <span class="n">drive_box</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_poisson_widget</span><span class="p">(</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">tstop_widget</span><span class="p">,</span>
    <span class="n">layout</span><span class="p">,</span>
    <span class="n">style</span><span class="p">,</span>
    <span class="n">location</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">weights_ampa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weights_nmda</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">delays</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">n_drive_cells</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cell_specific</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">default_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;tstart&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;tstop&quot;</span><span class="p">:</span> <span class="n">tstop_widget</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="s2">&quot;n_drive_cells&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;cell_specific&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;seedcore&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
        <span class="s2">&quot;rate_constant&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;L2_pyramidal&quot;</span><span class="p">:</span> <span class="mf">40.0</span><span class="p">,</span>
            <span class="s2">&quot;L5_pyramidal&quot;</span><span class="p">:</span> <span class="mf">40.0</span><span class="p">,</span>
            <span class="s2">&quot;L2_basket&quot;</span><span class="p">:</span> <span class="mf">40.0</span><span class="p">,</span>
            <span class="s2">&quot;L5_basket&quot;</span><span class="p">:</span> <span class="mf">40.0</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;n_drive_cells&quot;</span><span class="p">:</span> <span class="n">n_drive_cells</span><span class="p">,</span> <span class="s2">&quot;cell_specific&quot;</span><span class="p">:</span> <span class="n">cell_specific</span><span class="p">})</span>
    <span class="n">default_data</span> <span class="o">=</span> <span class="n">_update_nested_dict</span><span class="p">(</span><span class="n">default_data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">tstart</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;tstart&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Start time (ms)&quot;</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tstop</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">],</span>
        <span class="nb">max</span><span class="o">=</span><span class="n">tstop_widget</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Stop time (ms)&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">n_drive_cells</span> <span class="o">=</span> <span class="n">IntText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;n_drive_cells&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;No. Drive Cells:&quot;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;cell_specific&quot;</span><span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">cell_specific</span> <span class="o">=</span> <span class="n">Checkbox</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;cell_specific&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Cell-Specific&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">seedcore</span> <span class="o">=</span> <span class="n">IntText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;seedcore&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Seed&quot;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span>
    <span class="p">)</span>

    <span class="n">cell_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;L5_pyramidal&quot;</span><span class="p">,</span> <span class="s2">&quot;L2_pyramidal&quot;</span><span class="p">,</span> <span class="s2">&quot;L5_basket&quot;</span><span class="p">,</span> <span class="s2">&quot;L2_basket&quot;</span><span class="p">]</span>
    <span class="n">rate_constant</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">cell_types</span><span class="p">:</span>
        <span class="n">rate_constant</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;rate_constant&quot;</span><span class="p">][</span><span class="n">cell_type</span><span class="p">],</span>
            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_type</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">widgets_list</span><span class="p">,</span> <span class="n">widgets_dict</span> <span class="o">=</span> <span class="n">_get_drive_weight_widgets</span><span class="p">(</span>
        <span class="n">layout</span><span class="p">,</span>
        <span class="n">style</span><span class="p">,</span>
        <span class="n">location</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;weights_ampa&quot;</span><span class="p">:</span> <span class="n">weights_ampa</span><span class="p">,</span>
            <span class="s2">&quot;weights_nmda&quot;</span><span class="p">:</span> <span class="n">weights_nmda</span><span class="p">,</span>
            <span class="s2">&quot;delays&quot;</span><span class="p">:</span> <span class="n">delays</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">widgets_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;rate_constant&quot;</span><span class="p">:</span> <span class="n">rate_constant</span><span class="p">})</span>
    <span class="n">widgets_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span><span class="n">HTML</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;&lt;b&gt;Rate constants&lt;/b&gt;&quot;</span><span class="p">)]</span>
        <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">widgets_dict</span><span class="p">[</span><span class="s2">&quot;rate_constant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="p">)</span>

    <span class="c1"># Disable n_drive_cells widget based on cell_specific checkbox</span>
    <span class="n">cell_specific</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span>
        <span class="n">partial</span><span class="p">(</span><span class="n">_cell_spec_change</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">n_drive_cells</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;value&quot;</span>
    <span class="p">)</span>

    <span class="n">drive_box</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
        <span class="p">[</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">,</span> <span class="n">n_drive_cells</span><span class="p">,</span> <span class="n">cell_specific</span><span class="p">,</span> <span class="n">seedcore</span><span class="p">]</span> <span class="o">+</span> <span class="n">widgets_list</span>
    <span class="p">)</span>
    <span class="n">drive</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Poisson&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">tstart</span><span class="o">=</span><span class="n">tstart</span><span class="p">,</span>
        <span class="n">tstop</span><span class="o">=</span><span class="n">tstop</span><span class="p">,</span>
        <span class="n">rate_constant</span><span class="o">=</span><span class="n">rate_constant</span><span class="p">,</span>
        <span class="n">seedcore</span><span class="o">=</span><span class="n">seedcore</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>  <span class="c1"># notice this is a widget but a str!</span>
        <span class="n">n_drive_cells</span><span class="o">=</span><span class="n">n_drive_cells</span><span class="p">,</span>
        <span class="n">is_cell_specific</span><span class="o">=</span><span class="n">cell_specific</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">drive</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">widgets_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">drive</span><span class="p">,</span> <span class="n">drive_box</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_evoked_widget</span><span class="p">(</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">layout</span><span class="p">,</span>
    <span class="n">style</span><span class="p">,</span>
    <span class="n">location</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">weights_ampa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weights_nmda</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">delays</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">n_drive_cells</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cell_specific</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">default_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;numspikes&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;n_drive_cells&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;cell_specific&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;seedcore&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;n_drive_cells&quot;</span><span class="p">:</span> <span class="n">n_drive_cells</span><span class="p">,</span> <span class="s2">&quot;cell_specific&quot;</span><span class="p">:</span> <span class="n">cell_specific</span><span class="p">})</span>
    <span class="n">default_data</span> <span class="o">=</span> <span class="n">_update_nested_dict</span><span class="p">(</span><span class="n">default_data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Mean time:&quot;</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Std dev time:&quot;</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">numspikes</span> <span class="o">=</span> <span class="n">IntText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;numspikes&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;No. Spikes:&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="n">n_drive_cells</span> <span class="o">=</span> <span class="n">IntText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;n_drive_cells&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;No. Drive Cells:&quot;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;cell_specific&quot;</span><span class="p">],</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">cell_specific</span> <span class="o">=</span> <span class="n">Checkbox</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;cell_specific&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Cell-Specific&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="n">seedcore</span> <span class="o">=</span> <span class="n">IntText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">default_data</span><span class="p">[</span><span class="s2">&quot;seedcore&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Seed: &quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">widgets_list</span><span class="p">,</span> <span class="n">widgets_dict</span> <span class="o">=</span> <span class="n">_get_drive_weight_widgets</span><span class="p">(</span>
        <span class="n">layout</span><span class="p">,</span>
        <span class="n">style</span><span class="p">,</span>
        <span class="n">location</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;weights_ampa&quot;</span><span class="p">:</span> <span class="n">weights_ampa</span><span class="p">,</span>
            <span class="s2">&quot;weights_nmda&quot;</span><span class="p">:</span> <span class="n">weights_nmda</span><span class="p">,</span>
            <span class="s2">&quot;delays&quot;</span><span class="p">:</span> <span class="n">delays</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>

    <span class="c1"># Disable n_drive_cells widget based on cell_specific checkbox</span>
    <span class="n">cell_specific</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span>
        <span class="n">partial</span><span class="p">(</span><span class="n">_cell_spec_change</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">n_drive_cells</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;value&quot;</span>
    <span class="p">)</span>

    <span class="n">drive_box</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">mu</span><span class="p">,</span>
            <span class="n">sigma</span><span class="p">,</span>
            <span class="n">numspikes</span><span class="p">,</span>
            <span class="n">n_drive_cells</span><span class="p">,</span>
            <span class="n">cell_specific</span><span class="p">,</span>
            <span class="n">seedcore</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="o">+</span> <span class="n">widgets_list</span>
    <span class="p">)</span>
    <span class="n">drive</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Evoked&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span>
        <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
        <span class="n">numspikes</span><span class="o">=</span><span class="n">numspikes</span><span class="p">,</span>
        <span class="n">seedcore</span><span class="o">=</span><span class="n">seedcore</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
        <span class="n">sync_within_trial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">n_drive_cells</span><span class="o">=</span><span class="n">n_drive_cells</span><span class="p">,</span>
        <span class="n">is_cell_specific</span><span class="o">=</span><span class="n">cell_specific</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">drive</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">widgets_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">drive</span><span class="p">,</span> <span class="n">drive_box</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_tonic_widget</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tstop_widget</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">cell_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;L2_basket&quot;</span><span class="p">,</span> <span class="s2">&quot;L2_pyramidal&quot;</span><span class="p">,</span> <span class="s2">&quot;L5_basket&quot;</span><span class="p">,</span> <span class="s2">&quot;L5_pyramidal&quot;</span><span class="p">]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;t0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;tstop&quot;</span><span class="p">:</span> <span class="n">tstop_widget</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">default_values</span><span class="p">[</span><span class="s2">&quot;t0&quot;</span><span class="p">]</span>
    <span class="n">tstop</span> <span class="o">=</span> <span class="n">default_values</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">]</span>
    <span class="n">default_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">cell_type</span><span class="p">:</span> <span class="n">default_values</span> <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">cell_types</span><span class="p">}</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">default_data</span> <span class="o">=</span> <span class="n">_update_nested_dict</span><span class="p">(</span><span class="n">default_data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">amplitudes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">cell_types</span><span class="p">:</span>
        <span class="n">amplitude</span> <span class="o">=</span> <span class="n">default_data</span><span class="p">[</span><span class="n">cell_type</span><span class="p">][</span><span class="s2">&quot;amplitude&quot;</span><span class="p">]</span>
        <span class="n">amplitudes</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">cell_type</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="c1"># Reset the global t0 and stop with values from the &#39;data&#39; keyword.</span>
        <span class="c1"># It should be same across all the cell-types.</span>
        <span class="k">if</span> <span class="n">amplitude</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">default_data</span><span class="p">[</span><span class="n">cell_type</span><span class="p">][</span><span class="s2">&quot;t0&quot;</span><span class="p">]</span>
            <span class="n">tstop</span> <span class="o">=</span> <span class="n">default_data</span><span class="p">[</span><span class="n">cell_type</span><span class="p">][</span><span class="s2">&quot;tstop&quot;</span><span class="p">]</span>

    <span class="n">start_times</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Start time&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="n">stop_times</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="n">tstop</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Stop time&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>

    <span class="n">widgets_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="n">amplitudes</span><span class="p">,</span> <span class="s2">&quot;t0&quot;</span><span class="p">:</span> <span class="n">start_times</span><span class="p">,</span> <span class="s2">&quot;tstop&quot;</span><span class="p">:</span> <span class="n">stop_times</span><span class="p">}</span>
    <span class="n">widgets_list</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span><span class="n">HTML</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;&lt;b&gt;Times (ms):&lt;/b&gt;&quot;</span><span class="p">)]</span>
        <span class="o">+</span> <span class="p">[</span><span class="n">start_times</span><span class="p">,</span> <span class="n">stop_times</span><span class="p">]</span>
        <span class="o">+</span> <span class="p">[</span><span class="n">HTML</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;&lt;b&gt;Amplitude (nA):&lt;/b&gt;&quot;</span><span class="p">)]</span>
        <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">amplitudes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="p">)</span>

    <span class="n">drive_box</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span><span class="n">widgets_list</span><span class="p">)</span>
    <span class="n">drive</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Tonic&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitudes</span><span class="p">,</span>
        <span class="n">t0</span><span class="o">=</span><span class="n">start_times</span><span class="p">,</span>
        <span class="n">tstop</span><span class="o">=</span><span class="n">stop_times</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">drive</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">widgets_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">drive</span><span class="p">,</span> <span class="n">drive_box</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_build_drive_objects</span><span class="p">(</span>
    <span class="n">drive_type</span><span class="p">,</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">tstop_widget</span><span class="p">,</span>
    <span class="n">layout</span><span class="p">,</span>
    <span class="n">style</span><span class="p">,</span>
    <span class="n">location</span><span class="p">,</span>
    <span class="n">drive_data</span><span class="p">,</span>
    <span class="n">weights_ampa</span><span class="p">,</span>
    <span class="n">weights_nmda</span><span class="p">,</span>
    <span class="n">delays</span><span class="p">,</span>
    <span class="n">n_drive_cells</span><span class="p">,</span>
    <span class="n">cell_specific</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">drive_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Rhythmic&quot;</span><span class="p">,</span> <span class="s2">&quot;Bursty&quot;</span><span class="p">):</span>
        <span class="n">drive</span><span class="p">,</span> <span class="n">drive_box</span> <span class="o">=</span> <span class="n">_get_rhythmic_widget</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">tstop_widget</span><span class="p">,</span>
            <span class="n">layout</span><span class="p">,</span>
            <span class="n">style</span><span class="p">,</span>
            <span class="n">location</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">drive_data</span><span class="p">,</span>
            <span class="n">weights_ampa</span><span class="o">=</span><span class="n">weights_ampa</span><span class="p">,</span>
            <span class="n">weights_nmda</span><span class="o">=</span><span class="n">weights_nmda</span><span class="p">,</span>
            <span class="n">delays</span><span class="o">=</span><span class="n">delays</span><span class="p">,</span>
            <span class="n">n_drive_cells</span><span class="o">=</span><span class="n">n_drive_cells</span><span class="p">,</span>
            <span class="n">cell_specific</span><span class="o">=</span><span class="n">cell_specific</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">drive_type</span> <span class="o">==</span> <span class="s2">&quot;Poisson&quot;</span><span class="p">:</span>
        <span class="n">drive</span><span class="p">,</span> <span class="n">drive_box</span> <span class="o">=</span> <span class="n">_get_poisson_widget</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">tstop_widget</span><span class="p">,</span>
            <span class="n">layout</span><span class="p">,</span>
            <span class="n">style</span><span class="p">,</span>
            <span class="n">location</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">drive_data</span><span class="p">,</span>
            <span class="n">weights_ampa</span><span class="o">=</span><span class="n">weights_ampa</span><span class="p">,</span>
            <span class="n">weights_nmda</span><span class="o">=</span><span class="n">weights_nmda</span><span class="p">,</span>
            <span class="n">delays</span><span class="o">=</span><span class="n">delays</span><span class="p">,</span>
            <span class="n">n_drive_cells</span><span class="o">=</span><span class="n">n_drive_cells</span><span class="p">,</span>
            <span class="n">cell_specific</span><span class="o">=</span><span class="n">cell_specific</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">drive_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Evoked&quot;</span><span class="p">,</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">):</span>
        <span class="n">drive</span><span class="p">,</span> <span class="n">drive_box</span> <span class="o">=</span> <span class="n">_get_evoked_widget</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">layout</span><span class="p">,</span>
            <span class="n">style</span><span class="p">,</span>
            <span class="n">location</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">drive_data</span><span class="p">,</span>
            <span class="n">weights_ampa</span><span class="o">=</span><span class="n">weights_ampa</span><span class="p">,</span>
            <span class="n">weights_nmda</span><span class="o">=</span><span class="n">weights_nmda</span><span class="p">,</span>
            <span class="n">delays</span><span class="o">=</span><span class="n">delays</span><span class="p">,</span>
            <span class="n">n_drive_cells</span><span class="o">=</span><span class="n">n_drive_cells</span><span class="p">,</span>
            <span class="n">cell_specific</span><span class="o">=</span><span class="n">cell_specific</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">drive_type</span> <span class="o">==</span> <span class="s2">&quot;Tonic&quot;</span><span class="p">:</span>
        <span class="n">drive</span><span class="p">,</span> <span class="n">drive_box</span> <span class="o">=</span> <span class="n">_get_tonic_widget</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">tstop_widget</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">drive_data</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown drive type </span><span class="si">{</span><span class="n">drive_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">drive</span><span class="p">,</span> <span class="n">drive_box</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_connectivity_tab</span><span class="p">(</span>
    <span class="n">params</span><span class="p">,</span>
    <span class="n">connectivity_out</span><span class="p">,</span>
    <span class="n">connectivity_textfields</span><span class="p">,</span>
    <span class="n">cell_params_out</span><span class="p">,</span>
    <span class="n">cell_parameters_vboxes</span><span class="p">,</span>
    <span class="n">cell_layer_radio_button</span><span class="p">,</span>
    <span class="n">cell_type_radio_button</span><span class="p">,</span>
    <span class="n">global_gain_out</span><span class="p">,</span>
    <span class="n">global_gain_textfields</span><span class="p">,</span>
    <span class="n">layout</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add all possible connectivity boxes to connectivity tab.&quot;&quot;&quot;</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">dict_to_network</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># build network connectivity tab</span>
    <span class="n">add_network_connectivity_tab</span><span class="p">(</span>
        <span class="n">net</span><span class="p">,</span>
        <span class="n">connectivity_out</span><span class="p">,</span>
        <span class="n">connectivity_textfields</span><span class="p">,</span>
        <span class="n">global_gain_out</span><span class="p">,</span>
        <span class="n">global_gain_textfields</span><span class="p">,</span>
        <span class="n">layout</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># build cell parameters tab</span>
    <span class="n">add_cell_parameters_tab</span><span class="p">(</span>
        <span class="n">cell_params_out</span><span class="p">,</span>
        <span class="n">cell_parameters_vboxes</span><span class="p">,</span>
        <span class="n">cell_layer_radio_button</span><span class="p">,</span>
        <span class="n">cell_type_radio_button</span><span class="p">,</span>
        <span class="n">layout</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">net</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_network_connectivity_tab</span><span class="p">(</span>
    <span class="n">net</span><span class="p">,</span>
    <span class="n">connectivity_out</span><span class="p">,</span>
    <span class="n">connectivity_textfields</span><span class="p">,</span>
    <span class="n">global_gain_out</span><span class="p">,</span>
    <span class="n">global_gain_textfields</span><span class="p">,</span>
    <span class="n">layout</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates widgets for synaptic connectivity values and global synaptic gains&quot;&quot;&quot;</span>

    <span class="c1">### Global synaptic gains</span>
    <span class="c1"># ---------------------------------------------------------------</span>
    <span class="n">global_gain_out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
    <span class="n">gain_values</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">get_global_synaptic_gains</span><span class="p">()</span>
    <span class="n">gain_types</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;e_e&quot;</span><span class="p">,</span> <span class="s2">&quot;e_i&quot;</span><span class="p">,</span> <span class="s2">&quot;i_e&quot;</span><span class="p">,</span> <span class="s2">&quot;i_i&quot;</span><span class="p">)</span>

    <span class="c1"># Same as _get_connectivity_widgets</span>
    <span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;100px&quot;</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">gain_type</span> <span class="ow">in</span> <span class="n">gain_types</span><span class="p">:</span>
        <span class="n">gain_widget</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">gain_values</span><span class="p">[</span><span class="n">gain_type</span><span class="p">],</span>
            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">global_gain_type_display_dict</span><span class="p">[</span><span class="n">gain_type</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">gain_widget</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s2">&quot;220px&quot;</span>
        <span class="n">global_gain_textfields</span><span class="p">[</span><span class="n">gain_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">gain_widget</span>

    <span class="n">title_box</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &lt;div</span>
<span class="sd">        style=&quot;</span>
<span class="sd">            background: gray;</span>
<span class="sd">            color: white;</span>
<span class="sd">            width: 100%;</span>
<span class="sd">            margin-bottom: 2px;</span>
<span class="sd">            text-align: center;</span>
<span class="sd">        &quot;&gt;</span>
<span class="sd">        Global Synaptic Gain Modifiers</span>
<span class="sd">        &lt;/div&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="n">left_box</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">global_gain_textfields</span><span class="p">[</span><span class="s2">&quot;e_e&quot;</span><span class="p">],</span>
            <span class="n">global_gain_textfields</span><span class="p">[</span><span class="s2">&quot;e_i&quot;</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">right_box</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">global_gain_textfields</span><span class="p">[</span><span class="s2">&quot;i_e&quot;</span><span class="p">],</span>
            <span class="n">global_gain_textfields</span><span class="p">[</span><span class="s2">&quot;i_i&quot;</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">gain_vbox</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">title_box</span><span class="p">,</span>
            <span class="n">HBox</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">left_box</span><span class="p">,</span>
                    <span class="n">right_box</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
        <span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1px solid #bdbdbd&quot;</span><span class="p">,</span>  <span class="c1"># border width, style, and color</span>
            <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span>  <span class="c1"># optional: adds space inside the border</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">global_gain_out</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">gain_vbox</span><span class="p">)</span>

    <span class="c1">### Connectivity accordion</span>
    <span class="c1"># ---------------------------------------------------------------</span>
    <span class="n">cell_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">ct</span> <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">cell_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    <span class="n">receptors</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ampa&quot;</span><span class="p">,</span> <span class="s2">&quot;nmda&quot;</span><span class="p">,</span> <span class="s2">&quot;gabaa&quot;</span><span class="p">,</span> <span class="s2">&quot;gabab&quot;</span><span class="p">)</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;proximal&quot;</span><span class="p">,</span> <span class="s2">&quot;distal&quot;</span><span class="p">,</span> <span class="s2">&quot;soma&quot;</span><span class="p">)</span>

    <span class="c1"># clear existing connectivity</span>
    <span class="n">connectivity_out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity_textfields</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">connectivity_textfields</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="n">connectivity_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">src_gids</span> <span class="ow">in</span> <span class="n">cell_types</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">target_gids</span> <span class="ow">in</span> <span class="n">cell_types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
                <span class="c1"># the connectivity list should be built on this level</span>
                <span class="n">receptor_related_conn</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">receptor</span> <span class="ow">in</span> <span class="n">receptors</span><span class="p">:</span>
                    <span class="n">conn_indices</span> <span class="o">=</span> <span class="n">pick_connection</span><span class="p">(</span>
                        <span class="n">net</span><span class="o">=</span><span class="n">net</span><span class="p">,</span>
                        <span class="n">src_gids</span><span class="o">=</span><span class="n">src_gids</span><span class="p">,</span>
                        <span class="n">target_gids</span><span class="o">=</span><span class="n">target_gids</span><span class="p">,</span>
                        <span class="n">loc</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
                        <span class="n">receptor</span><span class="o">=</span><span class="n">receptor</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conn_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">conn_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="n">conn_idx</span> <span class="o">=</span> <span class="n">conn_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">current_w</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">conn_idx</span><span class="p">][</span><span class="s2">&quot;nc_dict&quot;</span><span class="p">][</span><span class="s2">&quot;A_weight&quot;</span><span class="p">]</span>
                        <span class="n">current_p</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">conn_idx</span><span class="p">][</span><span class="s2">&quot;probability&quot;</span><span class="p">]</span>
                        <span class="n">current_g</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">conn_idx</span><span class="p">][</span><span class="s2">&quot;nc_dict&quot;</span><span class="p">][</span><span class="s2">&quot;gain&quot;</span><span class="p">]</span>
                        <span class="c1"># valid connection</span>
                        <span class="n">receptor_related_conn</span><span class="p">[</span><span class="n">receptor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="n">current_w</span><span class="p">,</span>
                            <span class="s2">&quot;probability&quot;</span><span class="p">:</span> <span class="n">current_p</span><span class="p">,</span>
                            <span class="s2">&quot;gain&quot;</span><span class="p">:</span> <span class="n">current_g</span><span class="p">,</span>
                            <span class="c1"># info used to identify connection</span>
                            <span class="s2">&quot;receptor&quot;</span><span class="p">:</span> <span class="n">receptor</span><span class="p">,</span>
                            <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span>
                            <span class="s2">&quot;src_gids&quot;</span><span class="p">:</span> <span class="n">src_gids</span><span class="p">,</span>
                            <span class="s2">&quot;target_gids&quot;</span><span class="p">:</span> <span class="n">target_gids</span><span class="p">,</span>
                        <span class="p">}</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">receptor_related_conn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">connectivity_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src_gids</span><span class="si">}</span><span class="s2">→</span><span class="si">{</span><span class="n">target_gids</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                    <span class="n">connectivity_textfields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">_get_connectivity_widgets</span><span class="p">(</span>
                            <span class="n">receptor_related_conn</span><span class="p">,</span> <span class="n">global_gain_textfields</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

    <span class="c1"># Style the contents of the Connectivity Tab</span>
    <span class="c1"># -------------------------------------------------------------------------</span>

    <span class="c1"># define custom Vbox layout</span>
    <span class="c1"># no_padding_layout = Layout(padding=&quot;0&quot;, margin=&quot;0&quot;) # unused</span>

    <span class="c1"># Initialize sections within the Accordion</span>

    <span class="n">connectivity_boxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">VBox</span><span class="p">(</span><span class="n">slider</span><span class="p">)</span> <span class="k">for</span> <span class="n">slider</span> <span class="ow">in</span> <span class="n">connectivity_textfields</span><span class="p">]</span>

    <span class="c1"># Add class to child Vboxes for targeted CSS</span>
    <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">connectivity_boxes</span><span class="p">:</span>
        <span class="n">box</span><span class="o">.</span><span class="n">add_class</span><span class="p">(</span><span class="s2">&quot;connectivity-contents&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize the Accordion section</span>

    <span class="n">cell_connectivity</span> <span class="o">=</span> <span class="n">Accordion</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="n">connectivity_boxes</span><span class="p">)</span>

    <span class="c1"># Add class to Accordion section for targeted CSS</span>
    <span class="n">cell_connectivity</span><span class="o">.</span><span class="n">add_class</span><span class="p">(</span><span class="s2">&quot;connectivity-section&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">connectivity_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">connectivity_names</span><span class="p">):</span>
        <span class="n">cell_connectivity</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">connectivity_name</span><span class="p">)</span>

    <span class="c1"># Style the &lt;div&gt; automatically created around connectivity boxes</span>
    <span class="n">connectivity_out_style</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;style&gt;</span>
<span class="s2">        /* CSS to style elements inside the Accordion */</span>
<span class="s2">        .connectivity-section .jupyter-widget-Collapse-contents {</span>
<span class="s2">            padding: 0px 0px 10px 0px !important;</span>
<span class="s2">            margin: 0 !important;</span>
<span class="s2">        }</span>
<span class="s2">    &lt;/style&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Display the Accordion with styling</span>
    <span class="k">with</span> <span class="n">connectivity_out</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">connectivity_out_style</span><span class="p">,</span> <span class="n">cell_connectivity</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">net</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_cell_parameters_tab</span><span class="p">(</span>
    <span class="n">cell_params_out</span><span class="p">,</span>
    <span class="n">cell_parameters_vboxes</span><span class="p">,</span>
    <span class="n">cell_layer_radio_button</span><span class="p">,</span>
    <span class="n">cell_type_radio_button</span><span class="p">,</span>
    <span class="n">layout</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">L2_default_values</span> <span class="o">=</span> <span class="n">get_L2Pyr_params_default</span><span class="p">()</span>
    <span class="n">L5_default_values</span> <span class="o">=</span> <span class="n">get_L5Pyr_params_default</span><span class="p">()</span>
    <span class="n">cell_types</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;L2&quot;</span><span class="p">,</span> <span class="n">L2_default_values</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;L5&quot;</span><span class="p">,</span> <span class="n">L5_default_values</span><span class="p">)]</span>
    <span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;255px&quot;</span><span class="p">}</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">cell_types</span><span class="p">:</span>
        <span class="n">layer_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">cell_parameters_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;Biophysic&quot;</span> <span class="ow">in</span> <span class="n">layer</span> <span class="ow">or</span> <span class="s2">&quot;Geometry&quot;</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cell_type</span><span class="p">[</span>
                <span class="mi">0</span>
            <span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">cell_parameters_dict</span><span class="p">[</span><span class="n">layer</span><span class="p">]:</span>
                <span class="n">param_name</span><span class="p">,</span> <span class="n">param_units</span><span class="p">,</span> <span class="n">params_key</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">parameter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">parameter</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">parameter</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">default_value</span> <span class="o">=</span> <span class="n">get_cell_param_default_value</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">Pyr_</span><span class="si">{</span><span class="n">params_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">cell_type</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">param_units</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="n">min_value</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1000.0</span> <span class="k">if</span> <span class="n">param_units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s2">&quot;ms&quot;</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">text_field</span> <span class="o">=</span> <span class="n">BoundedFloatText</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">default_value</span><span class="p">,</span>
                    <span class="nb">min</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span>
                    <span class="nb">max</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span>
                    <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
                    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">text_field</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s2">&quot;350px&quot;</span>
                <span class="n">layer_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text_field</span><span class="p">)</span>
            <span class="n">cell_parameters_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> Pyramidal_</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">cell_parameters_vboxes</span><span class="p">[</span><span class="n">cell_parameters_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">VBox</span><span class="p">(</span><span class="n">layer_parameters</span><span class="p">)</span>
            <span class="n">layer_parameters</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># clear existing connectivity</span>
    <span class="n">cell_params_out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>

    <span class="c1"># Add cell parameters</span>
    <span class="n">_update_cell_params_vbox</span><span class="p">(</span>
        <span class="n">cell_params_out</span><span class="p">,</span>
        <span class="n">cell_parameters_vboxes</span><span class="p">,</span>
        <span class="n">cell_type_radio_button</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">cell_layer_radio_button</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_cell_param_default_value</span><span class="p">(</span><span class="n">cell_type_key</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">param_dict</span><span class="p">[</span><span class="n">cell_type_key</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">on_upload_data_change</span><span class="p">(</span><span class="n">change</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">viz_manager</span><span class="p">,</span> <span class="n">log_out</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">change</span><span class="p">[</span><span class="s2">&quot;owner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c1"># Parsing file information from the &#39;change&#39; object passed in from</span>
    <span class="c1"># the upload file widget.</span>
    <span class="n">data_dict</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dict_name</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">data_fname</span> <span class="o">=</span> <span class="n">dict_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">file_extension</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">dict_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># If data was already loaded return</span>
    <span class="k">if</span> <span class="n">data_fname</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;simulation_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">with</span> <span class="n">log_out</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found existing data: </span><span class="si">{</span><span class="n">data_fname</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Read the file</span>
    <span class="n">ext_content</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
    <span class="n">ext_content</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">ext_content</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">log_out</span><span class="p">:</span>
        <span class="c1"># Write loaded data to data object</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;simulation_data&quot;</span><span class="p">][</span><span class="n">data_fname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;net&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;dpls&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">_read_dipole_txt</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">ext_content</span><span class="p">),</span> <span class="n">file_extension</span><span class="p">)],</span>
        <span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;External data </span><span class="si">{</span><span class="n">data_fname</span><span class="si">}</span><span class="s2"> loaded.&quot;</span><span class="p">)</span>

        <span class="c1"># Create a dipole plot</span>
        <span class="n">_template_name</span> <span class="o">=</span> <span class="s2">&quot;[Blank] single figure&quot;</span>
        <span class="n">viz_manager</span><span class="o">.</span><span class="n">reset_fig_config_tabs</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="n">_template_name</span><span class="p">)</span>
        <span class="n">viz_manager</span><span class="o">.</span><span class="n">add_figure</span><span class="p">()</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="n">_idx2figname</span><span class="p">(</span><span class="n">viz_manager</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;fig_idx&quot;</span><span class="p">][</span><span class="s2">&quot;idx&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">process_configs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dipole_smooth&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;dipole_scaling&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="n">viz_manager</span><span class="o">.</span><span class="n">_simulate_edit_figure</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="p">,</span>
            <span class="n">ax_name</span><span class="o">=</span><span class="s2">&quot;ax0&quot;</span><span class="p">,</span>
            <span class="n">simulation_name</span><span class="o">=</span><span class="n">data_fname</span><span class="p">,</span>
            <span class="n">plot_type</span><span class="o">=</span><span class="s2">&quot;current dipole&quot;</span><span class="p">,</span>
            <span class="n">preprocessing_config</span><span class="o">=</span><span class="n">process_configs</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Reset the load file widget</span>
        <span class="n">change</span><span class="p">[</span><span class="s2">&quot;owner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_drive_widget_to_dict</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a dict of input widget values</span>

<span class="sd">    Input widgets for drive parameters are structured in a nested</span>
<span class="sd">    dictionary. This function recreates the nested dictionary replacing</span>
<span class="sd">    the input widget with its stored value.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    drive : dict</span>
<span class="sd">        The drive dictionary containing nested dictionaries for parameters with</span>
<span class="sd">        multiple input widgets.</span>
<span class="sd">    name : str</span>
<span class="sd">        key of the nested dictionary</span>

<span class="sd">    Returns : dict</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">drive</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_init_network_from_widgets</span><span class="p">(</span>
    <span class="n">params</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">,</span>
    <span class="n">tstop</span><span class="p">,</span>
    <span class="n">single_simulation_data</span><span class="p">,</span>
    <span class="n">drive_widgets</span><span class="p">,</span>
    <span class="n">connectivity_textfields</span><span class="p">,</span>
    <span class="n">cell_params_vboxes</span><span class="p">,</span>
    <span class="n">global_gain_textfields</span><span class="p">,</span>
    <span class="n">add_drive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct network and add drives.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;init network&quot;</span><span class="p">)</span>
    <span class="n">single_simulation_data</span><span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_to_network</span><span class="p">(</span>
        <span class="n">params</span><span class="p">,</span> <span class="n">read_drives</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">read_external_biases</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="c1"># Update with synaptic gains</span>
    <span class="n">global_gain_values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">widget</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">global_gain_textfields</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1"># adjust connectivity according to the connectivity_tab</span>
    <span class="k">for</span> <span class="n">connectivity_slider</span> <span class="ow">in</span> <span class="n">connectivity_textfields</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">vbox_key</span> <span class="ow">in</span> <span class="n">connectivity_slider</span><span class="p">:</span>
            <span class="n">conn_indices</span> <span class="o">=</span> <span class="n">pick_connection</span><span class="p">(</span>
                <span class="n">net</span><span class="o">=</span><span class="n">single_simulation_data</span><span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">],</span>
                <span class="n">src_gids</span><span class="o">=</span><span class="n">vbox_key</span><span class="o">.</span><span class="n">_belongsto</span><span class="p">[</span><span class="s2">&quot;src_gids&quot;</span><span class="p">],</span>
                <span class="n">target_gids</span><span class="o">=</span><span class="n">vbox_key</span><span class="o">.</span><span class="n">_belongsto</span><span class="p">[</span><span class="s2">&quot;target_gids&quot;</span><span class="p">],</span>
                <span class="n">loc</span><span class="o">=</span><span class="n">vbox_key</span><span class="o">.</span><span class="n">_belongsto</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">],</span>
                <span class="n">receptor</span><span class="o">=</span><span class="n">vbox_key</span><span class="o">.</span><span class="n">_belongsto</span><span class="p">[</span><span class="s2">&quot;receptor&quot;</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conn_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">conn_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="n">conn_idx</span> <span class="o">=</span> <span class="n">conn_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">single_simulation_data</span><span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">conn_idx</span><span class="p">][</span><span class="s2">&quot;nc_dict&quot;</span><span class="p">][</span>
                    <span class="s2">&quot;A_weight&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">vbox_key</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

                <span class="c1"># 1. identify which case of global_gain_textfield applies to this src/target</span>
                <span class="n">global_gain_type</span> <span class="o">=</span> <span class="n">global_gain_type_lookup_dict</span><span class="p">[</span>
                    <span class="p">(</span>
                        <span class="n">vbox_key</span><span class="o">.</span><span class="n">_belongsto</span><span class="p">[</span><span class="s2">&quot;src_gids&quot;</span><span class="p">],</span>
                        <span class="n">vbox_key</span><span class="o">.</span><span class="n">_belongsto</span><span class="p">[</span><span class="s2">&quot;target_gids&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">]</span>
                <span class="n">applied_global_gain_value</span> <span class="o">=</span> <span class="n">global_gain_values</span><span class="p">[</span><span class="n">global_gain_type</span><span class="p">]</span>

                <span class="c1"># 2. Multiply global by single synapse gain to get total</span>
                <span class="n">single_simulation_data</span><span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">conn_idx</span><span class="p">][</span><span class="s2">&quot;nc_dict&quot;</span><span class="p">][</span>
                    <span class="s2">&quot;gain&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="mi">1</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">applied_global_gain_value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">vbox_key</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="c1"># Update cell params</span>
    <span class="n">update_functions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;L2 Geometry&quot;</span><span class="p">:</span> <span class="n">_update_L2_geometry_cell_params</span><span class="p">,</span>
        <span class="s2">&quot;L5 Geometry&quot;</span><span class="p">:</span> <span class="n">_update_L5_geometry_cell_params</span><span class="p">,</span>
        <span class="s2">&quot;Synapses&quot;</span><span class="p">:</span> <span class="n">_update_synapse_cell_params</span><span class="p">,</span>
        <span class="s2">&quot;L2 Pyramidal_Biophysics&quot;</span><span class="p">:</span> <span class="n">_update_L2_biophysics_cell_params</span><span class="p">,</span>
        <span class="s2">&quot;L5 Pyramidal_Biophysics&quot;</span><span class="p">:</span> <span class="n">_update_L5_biophysics_cell_params</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Update cell params</span>
    <span class="k">for</span> <span class="n">vbox_key</span><span class="p">,</span> <span class="n">cell_param_list</span> <span class="ow">in</span> <span class="n">cell_params_vboxes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">update_function</span> <span class="ow">in</span> <span class="n">update_functions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">vbox_key</span><span class="p">:</span>
                <span class="n">cell_type</span> <span class="o">=</span> <span class="n">vbox_key</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">update_function</span><span class="p">(</span>
                    <span class="n">single_simulation_data</span><span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">],</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">cell_param_list</span><span class="o">.</span><span class="n">children</span>
                <span class="p">)</span>
                <span class="k">break</span>  <span class="c1"># update needed only once per vbox_key</span>

    <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="n">single_simulation_data</span><span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cell_types</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">single_simulation_data</span><span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cell_types</span><span class="p">[</span><span class="n">cell_type</span><span class="p">][</span>
            <span class="s2">&quot;cell_object&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">_update_end_pts</span><span class="p">()</span>
        <span class="n">single_simulation_data</span><span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cell_types</span><span class="p">[</span><span class="n">cell_type</span><span class="p">][</span>
            <span class="s2">&quot;cell_object&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">_compute_section_mechs</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">add_drive</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c1"># add drives to network</span>
    <span class="k">for</span> <span class="n">drive</span> <span class="ow">in</span> <span class="n">drive_widgets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">drive</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Tonic&quot;</span><span class="p">):</span>
            <span class="n">weights_amplitudes</span> <span class="o">=</span> <span class="n">_drive_widget_to_dict</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span> <span class="s2">&quot;amplitude&quot;</span><span class="p">)</span>
            <span class="n">single_simulation_data</span><span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add_tonic_bias</span><span class="p">(</span>
                <span class="n">amplitude</span><span class="o">=</span><span class="n">weights_amplitudes</span><span class="p">,</span>
                <span class="n">t0</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;t0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">tstop</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sync_inputs_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">n_drive_cells</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot;n_cells&quot;</span>
                    <span class="k">if</span> <span class="n">drive</span><span class="p">[</span><span class="s2">&quot;is_cell_specific&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">else</span> <span class="n">drive</span><span class="p">[</span><span class="s2">&quot;n_drive_cells&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="p">),</span>
                <span class="n">cell_specific</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;is_cell_specific&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">weights_ampa</span> <span class="o">=</span> <span class="n">_drive_widget_to_dict</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span> <span class="s2">&quot;weights_ampa&quot;</span><span class="p">)</span>
            <span class="n">weights_nmda</span> <span class="o">=</span> <span class="n">_drive_widget_to_dict</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span> <span class="s2">&quot;weights_nmda&quot;</span><span class="p">)</span>
            <span class="n">synaptic_delays</span> <span class="o">=</span> <span class="n">_drive_widget_to_dict</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span> <span class="s2">&quot;delays&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;drive type is </span><span class="si">{</span><span class="n">drive</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, location=</span><span class="si">{</span><span class="n">drive</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">drive</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Poisson&quot;</span><span class="p">:</span>
                <span class="n">rate_constant</span> <span class="o">=</span> <span class="n">_drive_widget_to_dict</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span> <span class="s2">&quot;rate_constant&quot;</span><span class="p">)</span>

                <span class="n">single_simulation_data</span><span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add_poisson_drive</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">tstart</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;tstart&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">tstop</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">rate_constant</span><span class="o">=</span><span class="n">rate_constant</span><span class="p">,</span>
                    <span class="n">location</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">],</span>
                    <span class="n">weights_ampa</span><span class="o">=</span><span class="n">weights_ampa</span><span class="p">,</span>
                    <span class="n">weights_nmda</span><span class="o">=</span><span class="n">weights_nmda</span><span class="p">,</span>
                    <span class="n">synaptic_delays</span><span class="o">=</span><span class="n">synaptic_delays</span><span class="p">,</span>
                    <span class="n">space_constant</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
                    <span class="n">event_seed</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;seedcore&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">sync_inputs_kwargs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">drive</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Evoked&quot;</span><span class="p">,</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">):</span>
                <span class="n">single_simulation_data</span><span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add_evoked_drive</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">mu</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">sigma</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">numspikes</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;numspikes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">location</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">],</span>
                    <span class="n">weights_ampa</span><span class="o">=</span><span class="n">weights_ampa</span><span class="p">,</span>
                    <span class="n">weights_nmda</span><span class="o">=</span><span class="n">weights_nmda</span><span class="p">,</span>
                    <span class="n">synaptic_delays</span><span class="o">=</span><span class="n">synaptic_delays</span><span class="p">,</span>
                    <span class="n">space_constant</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                    <span class="n">event_seed</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;seedcore&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">sync_inputs_kwargs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">drive</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Rhythmic&quot;</span><span class="p">,</span> <span class="s2">&quot;Bursty&quot;</span><span class="p">):</span>
                <span class="n">single_simulation_data</span><span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add_bursty_drive</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">tstart</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;tstart&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">tstart_std</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;tstart_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">tstop</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;tstop&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">location</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">],</span>
                    <span class="n">burst_rate</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;burst_rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">burst_std</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;burst_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">numspikes</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;numspikes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">weights_ampa</span><span class="o">=</span><span class="n">weights_ampa</span><span class="p">,</span>
                    <span class="n">weights_nmda</span><span class="o">=</span><span class="n">weights_nmda</span><span class="p">,</span>
                    <span class="n">synaptic_delays</span><span class="o">=</span><span class="n">synaptic_delays</span><span class="p">,</span>
                    <span class="n">event_seed</span><span class="o">=</span><span class="n">drive</span><span class="p">[</span><span class="s2">&quot;seedcore&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">sync_inputs_kwargs</span><span class="p">,</span>
                <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">run_button_clicked</span><span class="p">(</span>
    <span class="n">widget_simulation_name</span><span class="p">,</span>
    <span class="n">log_out</span><span class="p">,</span>
    <span class="n">drive_widgets</span><span class="p">,</span>
    <span class="n">all_data</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">,</span>
    <span class="n">tstop</span><span class="p">,</span>
    <span class="n">fig_default_params</span><span class="p">,</span>
    <span class="n">widget_default_smoothing</span><span class="p">,</span>
    <span class="n">widget_default_scaling</span><span class="p">,</span>
    <span class="n">widget_min_frequency</span><span class="p">,</span>
    <span class="n">widget_max_frequency</span><span class="p">,</span>
    <span class="n">ntrials</span><span class="p">,</span>
    <span class="n">backend_selection</span><span class="p">,</span>
    <span class="n">mpi_cmd</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="p">,</span>
    <span class="n">params</span><span class="p">,</span>
    <span class="n">simulation_status_bar</span><span class="p">,</span>
    <span class="n">simulation_status_contents</span><span class="p">,</span>
    <span class="n">connectivity_textfields</span><span class="p">,</span>
    <span class="n">viz_manager</span><span class="p">,</span>
    <span class="n">simulations_list_widget</span><span class="p">,</span>
    <span class="n">cell_parameters_widgets</span><span class="p">,</span>
    <span class="n">global_gain_textfields</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the simulation and plot outputs.&quot;&quot;&quot;</span>
    <span class="n">simulation_data</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="s2">&quot;simulation_data&quot;</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">log_out</span><span class="p">:</span>
        <span class="c1"># clear empty trash simulations</span>
        <span class="k">for</span> <span class="n">_name</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">simulation_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">simulation_data</span><span class="p">[</span><span class="n">_name</span><span class="p">][</span><span class="s2">&quot;dpls&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">simulation_data</span><span class="p">[</span><span class="n">_name</span><span class="p">]</span>

        <span class="n">_sim_name</span> <span class="o">=</span> <span class="n">widget_simulation_name</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">simulation_data</span><span class="p">[</span><span class="n">_sim_name</span><span class="p">][</span><span class="s2">&quot;net&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation with the same name exists!&quot;</span><span class="p">)</span>
            <span class="n">simulation_status_bar</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">simulation_status_contents</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span>
            <span class="k">return</span>

        <span class="n">_init_network_from_widgets</span><span class="p">(</span>
            <span class="n">params</span><span class="p">,</span>
            <span class="n">dt</span><span class="p">,</span>
            <span class="n">tstop</span><span class="p">,</span>
            <span class="n">simulation_data</span><span class="p">[</span><span class="n">_sim_name</span><span class="p">],</span>
            <span class="n">drive_widgets</span><span class="p">,</span>
            <span class="n">connectivity_textfields</span><span class="p">,</span>
            <span class="n">cell_parameters_widgets</span><span class="p">,</span>
            <span class="n">global_gain_textfields</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start simulation&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">backend_selection</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;MPI&quot;</span><span class="p">:</span>
            <span class="c1"># &#39;use_hwthreading_if_found&#39; and &#39;sensible_default_cores&#39; have</span>
            <span class="c1"># already been set elsewhere, and do not need to be re-set here.</span>
            <span class="c1"># Hardware-threading and oversubscription will always be disabled</span>
            <span class="c1"># to prevent edge cases in the GUI.</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="n">MPIBackend</span><span class="p">(</span>
                <span class="n">n_procs</span><span class="o">=</span><span class="n">n_jobs</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">mpi_cmd</span><span class="o">=</span><span class="n">mpi_cmd</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">override_hwthreading_option</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">override_oversubscribe_option</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="n">JoblibBackend</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using Joblib with </span><span class="si">{</span><span class="n">n_jobs</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> core(s).&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">backend</span><span class="p">:</span>
            <span class="n">simulation_status_bar</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">simulation_status_contents</span><span class="p">[</span><span class="s2">&quot;running&quot;</span><span class="p">]</span>
            <span class="n">simulation_data</span><span class="p">[</span><span class="n">_sim_name</span><span class="p">][</span><span class="s2">&quot;dpls&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simulate_dipole</span><span class="p">(</span>
                <span class="n">simulation_data</span><span class="p">[</span><span class="n">_sim_name</span><span class="p">][</span><span class="s2">&quot;net&quot;</span><span class="p">],</span>
                <span class="n">tstop</span><span class="o">=</span><span class="n">tstop</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">n_trials</span><span class="o">=</span><span class="n">ntrials</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">simulation_status_bar</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">simulation_status_contents</span><span class="p">[</span><span class="s2">&quot;finished&quot;</span><span class="p">]</span>

            <span class="n">sim_names</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">sim_name</span>
                <span class="k">for</span> <span class="n">sim_name</span> <span class="ow">in</span> <span class="n">simulation_data</span>
                <span class="k">if</span> <span class="n">simulation_data</span><span class="p">[</span><span class="n">sim_name</span><span class="p">][</span><span class="s2">&quot;net&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">]</span>

            <span class="n">simulations_list_widget</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">sim_names</span>
            <span class="n">simulations_list_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">sim_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">viz_manager</span><span class="o">.</span><span class="n">reset_fig_config_tabs</span><span class="p">()</span>

    <span class="c1"># update default visualization params in gui based on widget</span>
    <span class="n">fig_default_params</span><span class="p">[</span><span class="s2">&quot;default_smoothing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget_default_smoothing</span><span class="o">.</span><span class="n">value</span>
    <span class="n">fig_default_params</span><span class="p">[</span><span class="s2">&quot;default_scaling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget_default_scaling</span><span class="o">.</span><span class="n">value</span>
    <span class="n">fig_default_params</span><span class="p">[</span><span class="s2">&quot;default_min_frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget_min_frequency</span><span class="o">.</span><span class="n">value</span>
    <span class="n">fig_default_params</span><span class="p">[</span><span class="s2">&quot;default_max_frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget_max_frequency</span><span class="o">.</span><span class="n">value</span>

    <span class="c1"># change default visualization params in viz_manager to mirror gui</span>
    <span class="k">for</span> <span class="n">widget</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">fig_default_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">viz_manager</span><span class="o">.</span><span class="n">fig_default_params</span><span class="p">[</span><span class="n">widget</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">viz_manager</span><span class="o">.</span><span class="n">add_figure</span><span class="p">()</span>
    <span class="n">fig_name</span> <span class="o">=</span> <span class="n">_idx2figname</span><span class="p">(</span><span class="n">viz_manager</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;fig_idx&quot;</span><span class="p">][</span><span class="s2">&quot;idx&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax_plots</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;ax0&quot;</span><span class="p">,</span> <span class="s2">&quot;input histogram&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;ax1&quot;</span><span class="p">,</span> <span class="s2">&quot;current dipole&quot;</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">ax_name</span><span class="p">,</span> <span class="n">plot_type</span> <span class="ow">in</span> <span class="n">ax_plots</span><span class="p">:</span>
        <span class="n">viz_manager</span><span class="o">.</span><span class="n">_simulate_edit_figure</span><span class="p">(</span>
            <span class="n">fig_name</span><span class="p">,</span> <span class="n">ax_name</span><span class="p">,</span> <span class="n">_sim_name</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">,</span> <span class="p">{},</span> <span class="s2">&quot;plot&quot;</span>
        <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_update_cell_params_vbox</span><span class="p">(</span>
    <span class="n">cell_type_out</span><span class="p">,</span> <span class="n">cell_parameters_list</span><span class="p">,</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">cell_layer</span>
<span class="p">):</span>
    <span class="n">cell_parameters_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cell_layer</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">cell_layer</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Biophysics&quot;</span><span class="p">,</span> <span class="s2">&quot;Geometry&quot;</span><span class="p">]:</span>
        <span class="n">cell_parameters_key</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">cell_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Needed for the button to display L2/3, but the underlying data to use L2</span>
    <span class="n">cell_parameters_key</span> <span class="o">=</span> <span class="n">cell_parameters_key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;L2/3&quot;</span><span class="p">,</span> <span class="s2">&quot;L2&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cell_parameters_key</span> <span class="ow">in</span> <span class="n">cell_parameters_list</span><span class="p">:</span>
        <span class="n">cell_type_out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">cell_type_out</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="n">cell_parameters_list</span><span class="p">[</span><span class="n">cell_parameters_key</span><span class="p">])</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_update_L2_geometry_cell_params</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">cell_param_key</span><span class="p">,</span> <span class="n">param_list</span><span class="p">):</span>
    <span class="n">cell_params</span> <span class="o">=</span> <span class="n">param_list</span>
    <span class="n">cell_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_param_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_pyramidal&quot;</span>

    <span class="n">sections</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">cell_types</span><span class="p">[</span><span class="n">cell_type</span><span class="p">][</span><span class="s2">&quot;cell_object&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sections</span>
    <span class="c1"># Soma</span>
    <span class="n">sections</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_L</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">sections</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_diam</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">sections</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_cm</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">sections</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_Ra</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

    <span class="c1"># Dendrite common parameters</span>
    <span class="n">dendrite_cm</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">dendrite_Ra</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

    <span class="n">dendrite_sections</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sections</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;soma&quot;</span><span class="p">]</span>

    <span class="n">param_indices</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">)]</span>

    <span class="c1"># Dendrite</span>
    <span class="k">for</span> <span class="n">section</span><span class="p">,</span> <span class="n">indices</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dendrite_sections</span><span class="p">,</span> <span class="n">param_indices</span><span class="p">):</span>
        <span class="n">sections</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">_L</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">sections</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">_diam</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">sections</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">_cm</span> <span class="o">=</span> <span class="n">dendrite_cm</span>
        <span class="n">sections</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">_Ra</span> <span class="o">=</span> <span class="n">dendrite_Ra</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_update_L5_geometry_cell_params</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">cell_param_key</span><span class="p">,</span> <span class="n">param_list</span><span class="p">):</span>
    <span class="n">cell_params</span> <span class="o">=</span> <span class="n">param_list</span>
    <span class="n">cell_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_param_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_pyramidal&quot;</span>

    <span class="n">sections</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">cell_types</span><span class="p">[</span><span class="n">cell_type</span><span class="p">][</span><span class="s2">&quot;cell_object&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sections</span>
    <span class="c1"># Soma</span>
    <span class="n">sections</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_L</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">sections</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_diam</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">sections</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_cm</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">sections</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_Ra</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

    <span class="c1"># Dendrite common parameters</span>
    <span class="n">dendrite_cm</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">dendrite_Ra</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

    <span class="n">dendrite_sections</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sections</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;soma&quot;</span><span class="p">]</span>

    <span class="n">param_indices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="c1"># Dentrite</span>
    <span class="k">for</span> <span class="n">section</span><span class="p">,</span> <span class="n">indices</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dendrite_sections</span><span class="p">,</span> <span class="n">param_indices</span><span class="p">):</span>
        <span class="n">sections</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">_L</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">sections</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">_diam</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">sections</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">_cm</span> <span class="o">=</span> <span class="n">dendrite_cm</span>
        <span class="n">sections</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">_Ra</span> <span class="o">=</span> <span class="n">dendrite_Ra</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_update_synapse_cell_params</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">cell_param_key</span><span class="p">,</span> <span class="n">param_list</span><span class="p">):</span>
    <span class="n">cell_params</span> <span class="o">=</span> <span class="n">param_list</span>
    <span class="n">cell_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_param_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_pyramidal&quot;</span>
    <span class="n">network_synapses</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">cell_types</span><span class="p">[</span><span class="n">cell_type</span><span class="p">][</span><span class="s2">&quot;cell_object&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">synapses</span>
    <span class="n">synapse_sections</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ampa&quot;</span><span class="p">,</span> <span class="s2">&quot;nmda&quot;</span><span class="p">,</span> <span class="s2">&quot;gabaa&quot;</span><span class="p">,</span> <span class="s2">&quot;gabab&quot;</span><span class="p">]</span>

    <span class="n">param_indices</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">)]</span>

    <span class="c1"># Update Dendrite</span>
    <span class="k">for</span> <span class="n">section</span><span class="p">,</span> <span class="n">indices</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">synapse_sections</span><span class="p">,</span> <span class="n">param_indices</span><span class="p">):</span>
        <span class="n">network_synapses</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="s2">&quot;e&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">network_synapses</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="s2">&quot;tau1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">network_synapses</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="s2">&quot;tau2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_params</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_update_L2_biophysics_cell_params</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">cell_param_key</span><span class="p">,</span> <span class="n">param_list</span><span class="p">):</span>
    <span class="n">cell_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_param_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_pyramidal&quot;</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">cell_types</span><span class="p">[</span><span class="n">cell_type</span><span class="p">][</span><span class="s2">&quot;cell_object&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sections</span>
    <span class="c1"># Soma</span>
    <span class="n">mechs_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;hh2&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;gkbar_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;gnabar_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;el_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;gl_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;km&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;gbar_km&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">},</span>
    <span class="p">}</span>

    <span class="n">sections</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mechs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mechs_params</span><span class="p">)</span>

    <span class="c1"># dendrites</span>
    <span class="n">mechs_params</span><span class="p">[</span><span class="s2">&quot;hh2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;gkbar_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="s2">&quot;gnabar_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="s2">&quot;el_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="s2">&quot;gl_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">mechs_params</span><span class="p">[</span><span class="s2">&quot;km&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gbar_km&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>

    <span class="n">update_common_dendrite_sections</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="n">mechs_params</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_update_L5_biophysics_cell_params</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">cell_param_key</span><span class="p">,</span> <span class="n">param_list</span><span class="p">):</span>
    <span class="n">cell_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cell_param_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_pyramidal&quot;</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">cell_types</span><span class="p">[</span><span class="n">cell_type</span><span class="p">][</span><span class="s2">&quot;cell_object&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sections</span>
    <span class="c1"># Soma</span>
    <span class="n">mechs_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;hh2&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;gkbar_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;gnabar_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;el_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;gl_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;ca&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;gbar_ca&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">},</span>
        <span class="s2">&quot;cad&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;taur_cad&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">},</span>
        <span class="s2">&quot;kca&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;gbar_kca&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">},</span>
        <span class="s2">&quot;km&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;gbar_km&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">},</span>
        <span class="s2">&quot;cat&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;gbar_cat&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">},</span>
        <span class="s2">&quot;ar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;gbar_ar&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">},</span>
    <span class="p">}</span>

    <span class="n">sections</span><span class="p">[</span><span class="s2">&quot;soma&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mechs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mechs_params</span><span class="p">)</span>

    <span class="c1"># dendrites</span>
    <span class="n">mechs_params</span><span class="p">[</span><span class="s2">&quot;hh2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;gkbar_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="s2">&quot;gnabar_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="s2">&quot;el_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="s2">&quot;gl_hh2&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">mechs_params</span><span class="p">[</span><span class="s2">&quot;ca&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gbar_ca&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">mechs_params</span><span class="p">[</span><span class="s2">&quot;cad&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;taur_cad&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">mechs_params</span><span class="p">[</span><span class="s2">&quot;kca&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gbar_kca&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">mechs_params</span><span class="p">[</span><span class="s2">&quot;km&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gbar_km&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">mechs_params</span><span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gbar_cat&quot;</span><span class="p">:</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
    <span class="n">mechs_params</span><span class="p">[</span><span class="s2">&quot;ar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;gbar_ar&quot;</span><span class="p">:</span> <span class="n">partial</span><span class="p">(</span>
            <span class="n">_exp_g_at_dist</span><span class="p">,</span> <span class="n">gbar_at_zero</span><span class="o">=</span><span class="n">param_list</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">exp_term</span><span class="o">=</span><span class="mf">3e-3</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="n">update_common_dendrite_sections</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="n">mechs_params</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">update_common_dendrite_sections</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="n">mechs_params</span><span class="p">):</span>
    <span class="n">dendrite_sections</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sections</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;soma&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">dendrite_sections</span><span class="p">:</span>
        <span class="n">sections</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">mechs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mechs_params</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_serialize_simulation</span><span class="p">(</span><span class="n">log_out</span><span class="p">,</span> <span class="n">sim_data</span><span class="p">,</span> <span class="n">simulation_list_widget</span><span class="p">):</span>
    <span class="c1"># Only download if there is at least one simulation</span>
    <span class="n">sim_name</span> <span class="o">=</span> <span class="n">simulation_list_widget</span><span class="o">.</span><span class="n">value</span>

    <span class="k">with</span> <span class="n">log_out</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">serialize_simulation</span><span class="p">(</span><span class="n">sim_data</span><span class="p">,</span> <span class="n">sim_name</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">serialize_simulation</span><span class="p">(</span><span class="n">simulations_data</span><span class="p">,</span> <span class="n">simulation_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serializes simulation data to CSV.</span>

<span class="sd">    Creates a single CSV file or a ZIP file containing multiple CSVs,</span>
<span class="sd">    depending on the number of trials in the simulation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">simulation_data</span> <span class="o">=</span> <span class="n">simulations_data</span><span class="p">[</span><span class="s2">&quot;simulation_data&quot;</span><span class="p">]</span>
    <span class="n">csv_trials_output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># CSV file headers</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="s2">&quot;times,agg,L2,L5&quot;</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">, </span><span class="si">%f</span><span class="s2">, </span><span class="si">%f</span><span class="s2">, </span><span class="si">%f</span><span class="s2">&quot;</span>

    <span class="k">for</span> <span class="n">dpl_trial</span> <span class="ow">in</span> <span class="n">simulation_data</span><span class="p">[</span><span class="n">simulation_name</span><span class="p">][</span><span class="s2">&quot;dpls&quot;</span><span class="p">]:</span>
        <span class="c1"># Combine all data columns at once</span>
        <span class="n">signals_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">dpl_trial</span><span class="o">.</span><span class="n">times</span><span class="p">,</span>
                <span class="n">dpl_trial</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;agg&quot;</span><span class="p">],</span>
                <span class="n">dpl_trial</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;L2&quot;</span><span class="p">],</span>
                <span class="n">dpl_trial</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;L5&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Using StringIO to collect CSV data</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">signals_matrix</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
            <span class="n">csv_trials_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">csv_trials_output</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Return a single csv file</span>
        <span class="k">return</span> <span class="n">csv_trials_output</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;.csv&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Create zip file</span>
        <span class="k">return</span> <span class="n">_create_zip</span><span class="p">(</span><span class="n">csv_trials_output</span><span class="p">,</span> <span class="n">simulation_name</span><span class="p">),</span> <span class="s2">&quot;.zip&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_serialize_config</span><span class="p">(</span><span class="n">log_out</span><span class="p">,</span> <span class="n">sim_data</span><span class="p">,</span> <span class="n">simulation_list_widget</span><span class="p">):</span>
    <span class="c1"># Only download if there is at least one simulation</span>
    <span class="n">sim_name</span> <span class="o">=</span> <span class="n">simulation_list_widget</span><span class="o">.</span><span class="n">value</span>

    <span class="k">with</span> <span class="n">log_out</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">serialize_config</span><span class="p">(</span><span class="n">sim_data</span><span class="p">,</span> <span class="n">sim_name</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">serialize_config</span><span class="p">(</span><span class="n">simulations_data</span><span class="p">,</span> <span class="n">simulation_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serializes Network configuration data to json.&quot;&quot;&quot;</span>

    <span class="c1"># Get network from data dictionary</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">simulations_data</span><span class="p">[</span><span class="s2">&quot;simulation_data&quot;</span><span class="p">][</span><span class="n">simulation_name</span><span class="p">][</span><span class="s2">&quot;net&quot;</span><span class="p">]</span>

    <span class="c1"># Write to buffer</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">write_network_configuration</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_create_zip</span><span class="p">(</span><span class="n">csv_data_list</span><span class="p">,</span> <span class="n">simulation_name</span><span class="p">):</span>
    <span class="c1"># Zip all files and keep it in memory</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">zip_buffer</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_buffer</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">csv_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">csv_data_list</span><span class="p">):</span>
                <span class="n">zf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">simulation_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">csv_data</span><span class="p">)</span>
        <span class="n">zip_buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">zip_buffer</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">handle_backend_change</span><span class="p">(</span><span class="n">backend_type</span><span class="p">,</span> <span class="n">backend_config</span><span class="p">,</span> <span class="n">mpi_cmd</span><span class="p">,</span> <span class="n">n_jobs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Switch backends between MPI and Joblib.&quot;&quot;&quot;</span>
    <span class="n">backend_config</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">backend_config</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">backend_type</span> <span class="o">==</span> <span class="s2">&quot;MPI&quot;</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="n">VBox</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">[</span><span class="n">n_jobs</span><span class="p">,</span> <span class="n">mpi_cmd</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="n">backend_type</span> <span class="o">==</span> <span class="s2">&quot;Joblib&quot;</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="n">n_jobs</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_valid_add_tonic_input</span><span class="p">(</span><span class="n">drive_widgets</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">drive</span> <span class="ow">in</span> <span class="n">drive_widgets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">drive</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Tonic&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span><span class="w"> </span><span class="nf">launch</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Launch voila with hnn_widget.ipynb.</span>

<span class="sd">    You can pass voila commandline parameters as usual.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">voila.app</span><span class="w"> </span><span class="kn">import</span> <span class="n">main</span>

    <span class="n">notebook_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;hnn_widget.ipynb&quot;</span>
    <span class="n">main</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">notebook_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, HNN Developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>